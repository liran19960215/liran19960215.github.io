<!DOCTYPE html>


<html lang="en">


<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Cherry Blog
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

  
  

  

</head>

</html>

<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Cherry Blog</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['面朝大海，春暖花开', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article
  id="three-meshLine性能问题"
  class="article article-type-three"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/05/meshLine%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98/"
    >three meshLine性能问题</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/03/05/meshLine%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2021-03-05T02:15:13.000Z" itemprop="datePublished">2021-03-05</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/three/">three</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-写在前面"><a href="#1-写在前面" class="headerlink" title="1. 写在前面"></a>1. 写在前面</h2><p>在项目开发过程中需要实现飞线的功能，这本身是不难实现的，难的是飞线：</p>
<ul>
<li>有一定的宽度，不是1px；</li>
<li>有自己的纹理，不是纯色；</li>
<li>顶点随时发生改变，因为一直在飞。</li>
</ul>
<p>我能遇到的问题，肯定有人也遇到过，况且飞线这个是可视化中经常遇到的元素，使用场景非常多。因此我在网上找到了别人封装好的飞线组件<a href="https://github.com/spite/THREE.MeshLine" target="_blank" rel="noopener">THREE MeshLine</a>(注：这不是MrDoob写的three里面包含的组件，是网友后面基于three现有的功能封装的)，该组件被广泛使用且功能强大，能满足基本所有飞线的功能。所以我也应用到了项目中，但是在最终测试的阶段，却发现了页面卡顿的现象，最后定位到了<font style="color: orange;">THREE MeshLine</font>身上。下面就具体来记录一下问题。</p>
<h2 id="2-THREE-MeshLine源码解读"><a href="#2-THREE-MeshLine源码解读" class="headerlink" title="2. THREE MeshLine源码解读"></a>2. THREE MeshLine源码解读</h2><h3 id="2-1-使用方法"><a href="#2-1-使用方法" class="headerlink" title="2.1 使用方法"></a>2.1 使用方法</h3><ul>
<li>install<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i three.meshline</span><br></pre></td></tr></table></figure></li>
<li>import<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; MeshLine, MeshLineMaterial &#125; <span class="keyword">from</span> <span class="string">'three.meshline'</span>;</span><br></pre></td></tr></table></figure></li>
<li>use<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// geometry</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> line = <span class="keyword">new</span> MeshLine();</span><br><span class="line"><span class="comment">// 写入点坐标</span></span><br><span class="line">line.setPoints(points);</span><br><span class="line"><span class="comment">// 非均匀宽度的设置方法</span></span><br><span class="line"><span class="comment">// p is a decimal percentage of the number of points</span></span><br><span class="line"><span class="comment">// ie. point 200 of 250 points, p = 0.8</span></span><br><span class="line">line.setPoints(geometry, p =&gt; <span class="number">2</span>); <span class="comment">// 2倍宽度</span></span><br><span class="line">line.setPoints(geometry, p =&gt; <span class="number">1</span> - p); <span class="comment">// 宽度随p递增而线性递减</span></span><br><span class="line">line.setPoints(geometry, p =&gt; <span class="number">2</span> + <span class="built_in">Math</span>.sin(<span class="number">50</span> * p)); <span class="comment">// kuandu 随p正弦变化，变化范围[1, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// material</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> MeshLineMaterial(options);</span><br><span class="line"><span class="comment">// options的可配置项</span></span><br><span class="line">options = &#123;</span><br><span class="line">  map: 自定义纹理，若开启useMap, 则片元着色器中就回去取map的像素值</span><br><span class="line">  useMap: 是否启用自定义纹理</span><br><span class="line">  alphaMap: 透明度纹理，使用时需开启useMap</span><br><span class="line">  useAlphaMap: 是否启用透明度纹理</span><br><span class="line">  repeat: 纹理的重复方式，通过二维向量定义map和alphaMap在水平和垂直方向上的重叠方式</span><br><span class="line">  color: 线的颜色</span><br><span class="line">  opacity: 线的透明度，需要设置transparent: <span class="literal">true</span></span><br><span class="line">  alphaTest: 透明度检测</span><br><span class="line">  dashArray: 设置虚线的长度和间隔，<span class="number">0</span>代表连续不间断的线</span><br><span class="line">  dashOffset: 虚线的偏移，定义虚线从哪里开始，此属性常用来实现动线</span><br><span class="line">  dashRatio: 定义可见比例，<span class="number">0</span>代表全部可见，<span class="number">1</span>代表全部不可见</span><br><span class="line">  resolution: 通过二维向量来定义canvas的尺寸</span><br><span class="line">  sizeAttenuation: 定义线宽是否随距离衰减，<span class="number">0</span>代表衰减，<span class="number">1</span>代表为常数不衰减</span><br><span class="line">  lineWidth: 线宽，浮点数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mesh</span></span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> THREE.Mesh(line, material);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2-2-性能问题"><a href="#2-2-性能问题" class="headerlink" title="2.2 性能问题"></a>2.2 性能问题</h3><p>其实meshline到现在经过那么多开发者的使用，本身不存在性能问题，如果存在，早就被开发者提issue解决了，那么为什么笔者在使用的过程中会遇到性能问题呢？</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1615024047/blog/meshline%E6%80%A7%E8%83%BD/meshline%E6%80%A7%E8%83%BD_ajkgmw.png" /></center>

<p>根据2.1节中meshMaterial相关配置的介绍，假设现在以上图由红到蓝的渐变色作为map映射到飞线上，只需要设置map和useMap即可，这样每条飞线的问题都是由红到蓝的纹理。如何让飞线在不改变顶点的情况下动起来？此时飞线的纹理会怎么展示呢？<br>(<font style="color: orange">注：假设一条完整的渐变线有100个点组成，这里指的不改变顶点意思是这100个点的位置不变，这种情况下飞线动起来，例如每次只显示20个点的范围</font>)    </p>
<ul>
<li>飞线动画   </li>
</ul>
<p>可以通过设置dashArray、dashRatio属性生成1/3飞线的长度，然后通过设置dashOffest使刚生成的短线偏移，在render的过程中不断修改dataOffest的值，来达到动画的效果。<br>问题：这样产生的飞线，纹理同样只是原纹理的三分之一大小。假设100个点对应红到蓝的完整纹理，那么0到33个点对应的就是纹理的0-1/3的部分，偏移到33-66个点的时候，对应的大概就是1/3-2/3的部分，以此类推。</p>
<ul>
<li>性能卡点</li>
</ul>
<p>那如果想要飞线在非的过程中始终展示的是完整的纹理，怎么实现呢？这个时候我们只能通过不断调用<font style="color: orange">setPoints</font>方法去改变顶点，将完整的纹理映射到新的顶点范围内，这个就是笔者在开发过程中会遇到卡顿的原因。开发需求是完整的展示飞线的纹理并不断变换位置。我们来看下源码中<font style="color: orange">setPoints</font>的具体内容。<a href="https://github.com/spite/THREE.MeshLine/blob/master/src/THREE.MeshLine.js" target="_blank" rel="noopener">源码地址</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">MeshLine.prototype.setPoints = <span class="function"><span class="keyword">function</span>(<span class="params">points, wcb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(points <span class="keyword">instanceof</span> <span class="built_in">Float32Array</span>) &amp;&amp; !(points <span class="keyword">instanceof</span> <span class="built_in">Array</span>)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(</span><br><span class="line">      <span class="string">"ERROR: The BufferArray of points is not instancied correctly."</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// as the points are mutated we store them</span></span><br><span class="line">  <span class="comment">// for later retreival when necessary (declaritive architectures)</span></span><br><span class="line">  <span class="keyword">this</span>._points = points;</span><br><span class="line">  <span class="keyword">this</span>.widthCallback = wcb;</span><br><span class="line">  <span class="keyword">this</span>.positions = [];</span><br><span class="line">  <span class="keyword">this</span>.counters = [];</span><br><span class="line">  <span class="keyword">if</span> (points.length &amp;&amp; points[<span class="number">0</span>] <span class="keyword">instanceof</span> THREE.Vector3) &#123;</span><br><span class="line">    <span class="comment">// could transform Vector3 array into the array used below</span></span><br><span class="line">    <span class="comment">// but this approach will only loop through the array once</span></span><br><span class="line">    <span class="comment">// and is more performant</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; points.length; j++) &#123;</span><br><span class="line">      <span class="keyword">var</span> p = points[j];</span><br><span class="line">      <span class="keyword">var</span> c = j / points.length;</span><br><span class="line">      <span class="keyword">this</span>.positions.push(p.x, p.y, p.z);</span><br><span class="line">      <span class="keyword">this</span>.positions.push(p.x, p.y, p.z);</span><br><span class="line">      <span class="keyword">this</span>.counters.push(c);</span><br><span class="line">      <span class="keyword">this</span>.counters.push(c);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; points.length; j += <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> c = j / points.length;</span><br><span class="line">      <span class="keyword">this</span>.positions.push(points[j], points[j + <span class="number">1</span>], points[j + <span class="number">2</span>]);</span><br><span class="line">      <span class="keyword">this</span>.positions.push(points[j], points[j + <span class="number">1</span>], points[j + <span class="number">2</span>]);</span><br><span class="line">      <span class="keyword">this</span>.counters.push(c);</span><br><span class="line">      <span class="keyword">this</span>.counters.push(c);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.process();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中可以看出，每次调用setPoints方法都会将最近的顶点信息更新到this.positions和this.counters里面，单看这几行代码是不会有很大的性能消耗的，重点就是最后调用的<font style="color: orange">this.process()</font>方法，这个也是我定位卡顿的原因。</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1615028984/blog/meshline%E6%80%A7%E8%83%BD/meshline%E6%80%A7%E8%83%BD-2_yeeudb.png" /></center>

<p>可见这个方法对性能的影响是很大的，那我们就来看下process方法中到底都做了写什么事儿<br>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">MeshLine.prototype.process = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> l = <span class="keyword">this</span>.positions.length / <span class="number">6</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.previous = []</span><br><span class="line">  <span class="keyword">this</span>.next = []</span><br><span class="line">  <span class="keyword">this</span>.side = []</span><br><span class="line">  <span class="keyword">this</span>.width = []</span><br><span class="line">  <span class="keyword">this</span>.indices_array = []</span><br><span class="line">  <span class="keyword">this</span>.uvs = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> w</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> v</span><br><span class="line">  <span class="comment">// initial previous points</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.compareV3(<span class="number">0</span>, l - <span class="number">1</span>)) &#123;</span><br><span class="line">    v = <span class="keyword">this</span>.copyV3(l - <span class="number">2</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    v = <span class="keyword">this</span>.copyV3(<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.previous.push(v[<span class="number">0</span>], v[<span class="number">1</span>], v[<span class="number">2</span>])</span><br><span class="line">  <span class="keyword">this</span>.previous.push(v[<span class="number">0</span>], v[<span class="number">1</span>], v[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; l; j++) &#123;</span><br><span class="line">    <span class="comment">// sides</span></span><br><span class="line">    <span class="keyword">this</span>.side.push(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">this</span>.side.push(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// widths</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.widthCallback) w = <span class="keyword">this</span>.widthCallback(j / (l - <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">else</span> w = <span class="number">1</span></span><br><span class="line">    <span class="keyword">this</span>.width.push(w)</span><br><span class="line">    <span class="keyword">this</span>.width.push(w)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// uvs</span></span><br><span class="line">    <span class="keyword">this</span>.uvs.push(j / (l - <span class="number">1</span>), <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">this</span>.uvs.push(j / (l - <span class="number">1</span>), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (j &lt; l - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// points previous to poisitions</span></span><br><span class="line">      v = <span class="keyword">this</span>.copyV3(j)</span><br><span class="line">      <span class="keyword">this</span>.previous.push(v[<span class="number">0</span>], v[<span class="number">1</span>], v[<span class="number">2</span>])</span><br><span class="line">      <span class="keyword">this</span>.previous.push(v[<span class="number">0</span>], v[<span class="number">1</span>], v[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">      <span class="comment">// indices</span></span><br><span class="line">      <span class="keyword">var</span> n = j * <span class="number">2</span></span><br><span class="line">      <span class="keyword">this</span>.indices_array.push(n, n + <span class="number">1</span>, n + <span class="number">2</span>)</span><br><span class="line">      <span class="keyword">this</span>.indices_array.push(n + <span class="number">2</span>, n + <span class="number">1</span>, n + <span class="number">3</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// points after poisitions</span></span><br><span class="line">      v = <span class="keyword">this</span>.copyV3(j)</span><br><span class="line">      <span class="keyword">this</span>.next.push(v[<span class="number">0</span>], v[<span class="number">1</span>], v[<span class="number">2</span>])</span><br><span class="line">      <span class="keyword">this</span>.next.push(v[<span class="number">0</span>], v[<span class="number">1</span>], v[<span class="number">2</span>])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// last next point</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.compareV3(l - <span class="number">1</span>, <span class="number">0</span>)) &#123;</span><br><span class="line">    v = <span class="keyword">this</span>.copyV3(<span class="number">1</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    v = <span class="keyword">this</span>.copyV3(l - <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.next.push(v[<span class="number">0</span>], v[<span class="number">1</span>], v[<span class="number">2</span>])</span><br><span class="line">  <span class="keyword">this</span>.next.push(v[<span class="number">0</span>], v[<span class="number">1</span>], v[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// redefining the attribute seems to prevent range errors</span></span><br><span class="line">  <span class="comment">// if the user sets a differing number of vertices</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>._attributes || <span class="keyword">this</span>._attributes.position.count !== <span class="keyword">this</span>.positions.length) &#123;</span><br><span class="line">    <span class="keyword">this</span>._attributes = &#123;</span><br><span class="line">      position: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.positions), <span class="number">3</span>),</span><br><span class="line">      previous: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.previous), <span class="number">3</span>),</span><br><span class="line">      next: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.next), <span class="number">3</span>),</span><br><span class="line">      side: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.side), <span class="number">1</span>),</span><br><span class="line">      width: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.width), <span class="number">1</span>),</span><br><span class="line">      uv: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.uvs), <span class="number">2</span>),</span><br><span class="line">      index: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Uint16Array</span>(<span class="keyword">this</span>.indices_array), <span class="number">1</span>),</span><br><span class="line">      counters: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.counters), <span class="number">1</span>),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>._attributes.position.copyArray(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.positions))</span><br><span class="line">    <span class="keyword">this</span>._attributes.position.needsUpdate = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>._attributes.previous.copyArray(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.previous))</span><br><span class="line">    <span class="keyword">this</span>._attributes.previous.needsUpdate = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>._attributes.next.copyArray(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.next))</span><br><span class="line">    <span class="keyword">this</span>._attributes.next.needsUpdate = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>._attributes.side.copyArray(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.side))</span><br><span class="line">    <span class="keyword">this</span>._attributes.side.needsUpdate = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>._attributes.width.copyArray(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.width))</span><br><span class="line">    <span class="keyword">this</span>._attributes.width.needsUpdate = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>._attributes.uv.copyArray(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.uvs))</span><br><span class="line">    <span class="keyword">this</span>._attributes.uv.needsUpdate = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>._attributes.index.copyArray(<span class="keyword">new</span> <span class="built_in">Uint16Array</span>(<span class="keyword">this</span>.indices_array))</span><br><span class="line">    <span class="keyword">this</span>._attributes.index.needsUpdate = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.setAttribute(<span class="string">'position'</span>, <span class="keyword">this</span>._attributes.position)</span><br><span class="line">  <span class="keyword">this</span>.setAttribute(<span class="string">'previous'</span>, <span class="keyword">this</span>._attributes.previous)</span><br><span class="line">  <span class="keyword">this</span>.setAttribute(<span class="string">'next'</span>, <span class="keyword">this</span>._attributes.next)</span><br><span class="line">  <span class="keyword">this</span>.setAttribute(<span class="string">'side'</span>, <span class="keyword">this</span>._attributes.side)</span><br><span class="line">  <span class="keyword">this</span>.setAttribute(<span class="string">'width'</span>, <span class="keyword">this</span>._attributes.width)</span><br><span class="line">  <span class="keyword">this</span>.setAttribute(<span class="string">'uv'</span>, <span class="keyword">this</span>._attributes.uv)</span><br><span class="line">  <span class="keyword">this</span>.setAttribute(<span class="string">'counters'</span>, <span class="keyword">this</span>._attributes.counters)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.setIndex(<span class="keyword">this</span>._attributes.index)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.computeBoundingSphere()</span><br><span class="line">  <span class="keyword">this</span>.computeBoundingBox()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出process方法的功能是根据新顶点生成对应的新的<font style="color: orange">position、previous、next、side、width、uv、counters</font>这几个BufferAttribute，然后传到顶点着色器中重新渲染。(注：为什么要生成这些，我们下一节中会讲解)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>._attributes = &#123;</span><br><span class="line">  position: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.positions), <span class="number">3</span>),</span><br><span class="line">  previous: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.previous), <span class="number">3</span>),</span><br><span class="line">  next: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.next), <span class="number">3</span>),</span><br><span class="line">  side: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.side), <span class="number">1</span>),</span><br><span class="line">  width: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.width), <span class="number">1</span>),</span><br><span class="line">  uv: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.uvs), <span class="number">2</span>),</span><br><span class="line">  index: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Uint16Array</span>(<span class="keyword">this</span>.indices_array), <span class="number">1</span>),</span><br><span class="line">  counters: <span class="keyword">new</span> THREE.BufferAttribute(<span class="keyword">new</span> <span class="built_in">Float32Array</span>(<span class="keyword">this</span>.counters), <span class="number">1</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>问题就在与每次都是新建而不是替换，所以造成了性能问题。最后为了解决项目中遇到的性能问题，笔者决定自己实现飞线的渲染，即使用自定义材料，重写顶点和片元着色器。</p>
<h2 id="3-自定义shader"><a href="#3-自定义shader" class="headerlink" title="3. 自定义shader"></a>3. 自定义shader</h2><h3 id="3-1-如何在webgl中画一根2px的线"><a href="#3-1-如何在webgl中画一根2px的线" class="headerlink" title="3.1 如何在webgl中画一根2px的线"></a>3.1 如何在webgl中画一根2px的线</h3><ul>
<li>模拟线条</li>
</ul>
<p>以一条线段为例，描述一条线段只需要2个端点，如果用面来描述，则需要4个点；绘制2条线，需要6个点。因此，如果想用面去表示一条n个端点的线，就需要2n个点去描述。</p>
<ul>
<li>确定面上点的位置</li>
</ul>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1615029756/blog/meshline%E6%80%A7%E8%83%BD/meshline%E6%80%A7%E8%83%BD-3_rlpkbt.png" /></center>

<p>以上图为例，取每个线段端点的法线方向为a1方向，取法线负方向为a2方向，分别乘宽度的一般，就可以得到a1和a2的位置，b点同理。</p>
<ul>
<li>a和b点的法线方向</li>
</ul>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1615029892/blog/meshline%E6%80%A7%E8%83%BD/meshline%E6%80%A7%E8%83%BD-4_tc6a4v.png" /></center>

<p>以上图为例，用last、current、next三点，酸楚current点点切线方向，切线方向乘以复数i，即逆时针旋转90度，为法线方向；乘以复数-i，即顺时针旋转90度为负法线方向，则有了Normal和-Normal。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">vec2</span> dir1 = <span class="built_in">normalize</span>(currentV2 - lastV2)</span><br><span class="line"><span class="type">vec2</span> dir2 = <span class="built_in">normalize</span>(nextV2- currentV2);</span><br><span class="line"><span class="type">vec2</span> dir = <span class="built_in">normalize</span>(dir1 + dir2);</span><br><span class="line"><span class="type">vec2</span> normal = <span class="type">vec2</span>(-dir.y, dir.x)</span><br></pre></td></tr></table></figure>

<p>现在有了面线，但是这是一个二维方法，转换个角度可能就变成一根线了。</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1615030433/blog/meshline%E6%80%A7%E8%83%BD/v2-16a07e683bb024c5ddaeb1a2684e27c4_b_v4moiq.gif" /></center>

<p>我们想要的是无论相机怎么旋转，线都是一样粗的，就好像一个三维的面一样。怎么实现呢？我们通过在着色器里对乘完投影矩阵后的二维坐标进行线的“拉宽”计算。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">mat4</span> pvm = projectionMatrix *modelViewMatrix;</span><br><span class="line"></span><br><span class="line"><span class="type">vec4</span> currentV4 = pvm * <span class="type">vec4</span>(position,<span class="number">1.0</span>);</span><br><span class="line"><span class="type">vec4</span> prevV4 = pvm * <span class="type">vec4</span>(prevPositions,<span class="number">1.0</span>);</span><br><span class="line"><span class="type">vec4</span> nextV4 = pvm * <span class="type">vec4</span>(nextPositions,<span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> currentV2 = currentV4.xy /currentV4.w;</span><br><span class="line">currentV2.x *= aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> prevV2 = prevV4.xy / prevV4.w;</span><br><span class="line">prevV2.x *= aspect;</span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> nextV2 = nextV4.xy / nextV4.w;</span><br><span class="line">nextV2.x *= aspect;</span><br></pre></td></tr></table></figure>

<p>这样就可以得到一个任意旋转看都是有一定宽度的“面线”了。</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1615030692/blog/meshline%E6%80%A7%E8%83%BD/meshline%E6%80%A7%E8%83%BD-5_bcj9wx.gif" /></center>

<h3 id="3-2-通过uv改变纹理"><a href="#3-2-通过uv改变纹理" class="headerlink" title="3.2 通过uv改变纹理"></a>3.2 通过uv改变纹理</h3><p>通过3.1节的介绍，我们可以自己通过shader实现有一定宽度的线了，但是当我们改变顶点的时候，仍然需要更新position、previous、next、side、width、uv这些值，只不过我们现在可以控制每次不新建，而是去更新。那还能不能进一步减少计算，进行优化呢？</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1615031163/blog/meshline%E6%80%A7%E8%83%BD/meshline%E6%80%A7%E8%83%BD-6_i7yso8.png" /></center>

<p>假设飞线的轨迹是固定的，即轨迹就是上述完整纹理所代表的100个点，那么我们最终想要的结果是飞线在飞的过程中，0-33、33-66、66-100展示的都是完整的纹理，此时我们是不是只需要更改顶点对应的纹理坐标就可以了呢？</p>
<p>以0-33个点代表的第一小段飞线为例，此时我们在片元着色器中将原始uv值大于0.33的点discard，然后重新计算0-33个点对应的纹理坐标，以1为单位等分，然后传给片元着色器，去取texture对应的像素值即可。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uniform</span> <span class="type">sampler2D</span> map;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">float</span> u_step;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">float</span> u_length;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">float</span> u_offset;</span><br><span class="line"><span class="keyword">varying</span> <span class="type">vec3</span> v_UV;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main () &#123;</span><br><span class="line">  <span class="type">vec2</span> u_UV;</span><br><span class="line">  <span class="type">float</span> real_length;</span><br><span class="line">  <span class="type">float</span> start;</span><br><span class="line">  <span class="type">float</span> end;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// start和end即代表飞线的范围</span></span><br><span class="line">  start = <span class="built_in">mod</span>(u_step + u_offset, <span class="number">1.0</span>);</span><br><span class="line">  <span class="keyword">if</span>(start &gt;= <span class="number">1.0</span>) start = <span class="number">1.0</span>;</span><br><span class="line">  end = u_length + start;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不在start和end范围内的点discard</span></span><br><span class="line">  <span class="keyword">if</span>(v_UV.x &gt; end) <span class="keyword">discard</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(v_UV.x &lt; start) <span class="keyword">discard</span>;</span><br><span class="line">  <span class="comment">// 重新计算纹理坐标</span></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(end &gt; <span class="number">1.0</span>) real_length = <span class="number">1.0</span> - start;</span><br><span class="line">    u_UV = <span class="type">vec2</span>((v_UV.x - start) / real_length, v_UV.y);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">gl_FragColor</span> = <span class="built_in">texture2D</span>(map, u_UV);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-拓展功能"><a href="#3-3-拓展功能" class="headerlink" title="3.3 拓展功能"></a>3.3 拓展功能</h3><p>现在我们已经尽可能优化了飞线的实现方法，但在实际开发过程中，往往由于整体的美观性会有其他需求，例如：</p>
<ul>
<li>不同飞线从不同位置开始飞；</li>
<li>不同飞线对应不同的纹理；</li>
<li>飞线的范围是从0-1，长度假设为0.2，那么要求飞线从0开始的时候不能突然冒出0.2的长度，要从0-0.2缓慢变长，且保证纹理的完整性等；</li>
<li>当飞线的尾端，即start + length大于整条线的终点1时临界条件该怎么处理等。</li>
</ul>
<p>其实这些问题笔者在本次开发过程中全部都遇到了，也实现了全部的功能，在这里简单介绍一下，思路还是从片元着色器入手。</p>
<ul>
<li>不同飞线从不同位置开始飞</li>
</ul>
<p>为例性能优化，假设有5条飞线，每条飞线100个点，笔者是将这500个点放在一个geometry中，并没有每条线新建一个geometry，那么如果区分哪个点在哪条线上，是一个问题，在开发过程中我将二维uv坐标变成了三维，z字段就用来记录在第几条飞线，x、y字段对应正常的uv坐标。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">lines.forEach(<span class="function">(<span class="params">line, idx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> points = line.points;</span><br><span class="line">  <span class="keyword">const</span> len = points.length;</span><br><span class="line">  points.forEach(<span class="function">(<span class="params">point, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.current.push(......);</span><br><span class="line">    <span class="keyword">this</span>.pre.push(......);</span><br><span class="line">    <span class="keyword">this</span>.next.push(......);</span><br><span class="line">    <span class="keyword">this</span>.side.push(......);</span><br><span class="line">    <span class="keyword">this</span>.index.push(......);</span><br><span class="line">    <span class="keyword">this</span>.uvs.push(index / (len - <span class="number">1</span>), <span class="number">0</span>, idx);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>将uv坐标通过顶点着色器传给片元着色器后，进行处理：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将uv的z字段作为偏移的附加量，这样每条飞线对应的起点就不同</span></span><br><span class="line"><span class="type">float</span> start = <span class="built_in">mod</span>(u_step + v_UV.z * u_offset, <span class="number">1.0</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>不同飞线对应不同的纹理</li>
</ul>
<p>同样利用uv坐标的z字段：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uniform</span> <span class="type">sampler2D</span> map1;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">sampler2D</span> map2;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">sampler2D</span> map3;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main () &#123;</span><br><span class="line">  .....</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 纹理随机</span></span><br><span class="line">  <span class="type">float</span> textureIndex = <span class="built_in">mod</span>(v_UV.z, <span class="number">3.0</span>);</span><br><span class="line">  <span class="keyword">if</span>(textureIndex - <span class="number">0.0</span> &lt; <span class="number">0.01</span>) <span class="built_in">gl_FragColor</span> = <span class="built_in">texture2D</span>(map1, u_UV);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(textureIndex - <span class="number">1.0</span> &lt; <span class="number">0.01</span>) <span class="built_in">gl_FragColor</span> = <span class="built_in">texture2D</span>(map2, u_UV);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">gl_FragColor</span> = <span class="built_in">texture2D</span>(map3, u_UV);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>start和end的临界判断</li>
</ul>
<p>这部分针对不同的场景，要求可能会有很大的区别，不过实现的原理依旧是在片元着色器中对start和end的值进行处理，超出部分的像素点discard或者其他操作，这里就不详细介绍了。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/spite/THREE.MeshLine" target="_blank" rel="noopener">THREE.MeshLine</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/35837423" target="_blank" rel="noopener">如何在webgl中画一根2px的线­</a></p>
 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
    <article
  id="post-css实现轮播效果"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/04/css%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E6%95%88%E6%9E%9C/"
    >css实现轮播效果</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/03/04/css%E5%AE%9E%E7%8E%B0%E8%BD%AE%E6%92%AD%E6%95%88%E6%9E%9C/" class="article-date">
  <time datetime="2021-03-04T06:40:30.000Z" itemprop="datePublished">2021-03-04</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/css/">css</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-写在前面"><a href="#1-写在前面" class="headerlink" title="1. 写在前面"></a>1. 写在前面</h2><p>在开发过程中会遇到几张图片轮播或者是列表轮播的需求，如何实现几张图片无缝的顺滑轮播呢？可以通过帧动画实现，在这里记录一下解决方法。</p>
<h2 id="2-图片轮播"><a href="#2-图片轮播" class="headerlink" title="2. 图片轮播"></a>2. 图片轮播</h2><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614840788/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-1_u0xksr.png" />
以横向轮播为例，轮播图片并排排列成一张很宽的图片，如图所示手机屏幕的宽度是固定的，因此隔一段时间就将图片向左平移一张图片的宽度(假设图片和手机屏幕同宽)，这样就在视觉上会有图片轮播的效果。

<h3 id="2-1-图片水平排列"><a href="#2-1-图片水平排列" class="headerlink" title="2.1 图片水平排列"></a>2.1 图片水平排列</h3><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614842824/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-2_tqmxao.png" />

<p>图中黑色边框的部分代表屏幕显示的区域，超出部分手机屏幕不可见。 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner-wrapper"</span>&gt;</span>    // 该div的大小是可见区域的大小</span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"banner-list"</span>&gt;</span>      // 这一层的区域大小是所有图片加起来的大小</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">id</span>=<span class="string">"item1"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">id</span>=<span class="string">"item2"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">id</span>=<span class="string">"item3"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">id</span>=<span class="string">"item4"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.banner</span> &#123;</span><br><span class="line">	<span class="attribute">border</span>: <span class="number">4px</span> solid black;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">	<span class="attribute">box-sizing</span>: content-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner</span> <span class="selector-class">.banner-wrapper</span> &#123;</span><br><span class="line">	<span class="attribute">position</span>: relative;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">1200px</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">position</span>: absolute;</span><br><span class="line">	<span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-class">.item</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">display</span>: inline-block;</span><br><span class="line">	<span class="attribute">float</span>: left;</span><br><span class="line">	<span class="attribute">font-weight</span>: bold;</span><br><span class="line">	<span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">	<span class="attribute">line-height</span>: <span class="number">150px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-class">.item</span><span class="selector-id">#item1</span>&#123;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#9370DB</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-class">.item</span><span class="selector-id">#item2</span> &#123;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#7B68EE</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-class">.item</span><span class="selector-id">#item3</span> &#123;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#6A5ACD</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-class">.item</span><span class="selector-id">#item4</span> &#123;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#483D8B</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>html代码：水平排列了需要轮播的图片；   </li>
<li>css代码： 用left和right属性操作图片左右轮播，所以要把轮播列表的<font style="color: orange">position</font>设置成为<font style="color: orange">absolute</font>，相应的父节点设置为<font style="color: orange">relative</font>，即轮播列表相对于父节点是绝对位置。水平排列，要设置float属性，将<font style="color: orange">float: left</font>设置到每个轮播项中，代表排列的时候左对齐。</li>
</ul>
<h3 id="2-2-隐藏屏幕可见范围外的区域"><a href="#2-2-隐藏屏幕可见范围外的区域" class="headerlink" title="2.2 隐藏屏幕可见范围外的区域"></a>2.2 隐藏屏幕可见范围外的区域</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">banner</span> <span class="selector-class">.banner-wrapper</span> &#123;</span><br><span class="line">	<span class="attribute">position</span>: relative;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>wrapper代表的是屏幕范围，通过设置<font style="color: orange">overflow: hidden</font>来隐藏超出的内容</p>
<h3 id="2-3-动画"><a href="#2-3-动画" class="headerlink" title="2.3 动画"></a>2.3 动画</h3><center><video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614849570/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-3_b5c45a.mp4" autoplay ></center>

<p>轮播动画利用帧动画<font style="color: orange">keyframes</font>实现。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> banner-swipe &#123;</span><br><span class="line">  0% &#123; <span class="attribute">left</span>: <span class="number">0</span>; &#125;</span><br><span class="line">  33<span class="selector-class">.33</span>% &#123; <span class="attribute">left</span>: -<span class="number">300px</span>; &#125;</span><br><span class="line">  66<span class="selector-class">.66</span>% &#123; <span class="attribute">left</span>: -<span class="number">600px</span>; &#125;</span><br><span class="line">  100% &#123; <span class="attribute">left</span>: -<span class="number">900px</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">  <span class="attribute">animation</span>: banner-swipe <span class="number">10s</span> ease-in infinite;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上述代码所示，定义了一个帧动画。因为只有四张图片，所以只要滚动三次就能轮播一遍，因此每次滚动占用的时间约为33.33%, 滚动的变化量为一张图片的宽度。(注：假设有n张图片，则须滚动<font style="color: orange">n-1</font>次，每次占用的时间为<font style="color: orange">1/(n-1)</font>)接着我们在banner-list中绑定帧动画<font style="color: orange">banner-swipe</font>，规定完成一次动画需要10s，<font style="color: orange">infinite</font>代表无限循环。</p>
<p>现在我们已经实现轮播效果了，但是很明显存在个问题，就是一次动画执行完成后，第一张图片会立马出现，而不是从第四张到第一张慢慢展现。</p>
<h4 id="2-3-1-动画稳定过渡"><a href="#2-3-1-动画稳定过渡" class="headerlink" title="2.3.1 动画稳定过渡"></a>2.3.1 动画稳定过渡</h4><p>我们把隐藏部分的动画也展示出来。</p>
<center><video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614849903/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-4_s2ul2p.mp4" autoplay ></center>

<p>完整的动画可以很明显看出，4之后立马跳到了1，导致了突然的过渡。<strong>解决办法</strong>是在第四张图片后面再加张第一张图片，同时帧动画里再插入一帧。</p>
<center><video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614850525/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-5_dqp7z6.mp4" autoplay style="height: 150px;"></center>

<center><video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614850704/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-6_obez9o.mp4" autoplay ></center>

<p>从动画中可以看出，通过上述操作，保证了滚动的连续性。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner-wrapper"</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"banner-list"</span>&gt;</span>      </span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">id</span>=<span class="string">"item1"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">id</span>=<span class="string">"item2"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">id</span>=<span class="string">"item3"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">id</span>=<span class="string">"item4"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">id</span>=<span class="string">"item4"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> banner-swipe &#123;</span><br><span class="line">  0% &#123; <span class="attribute">left</span>: <span class="number">0</span>; &#125;</span><br><span class="line">  25% &#123; <span class="attribute">left</span>: -<span class="number">300px</span>; &#125;</span><br><span class="line">  50% &#123; <span class="attribute">left</span>: -<span class="number">600px</span>; &#125;</span><br><span class="line">  75% &#123; <span class="attribute">left</span>: -<span class="number">900px</span>; &#125;</span><br><span class="line">  100% &#123; <span class="attribute">left</span>: -<span class="number">1200px</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-动画停顿"><a href="#2-3-2-动画停顿" class="headerlink" title="2.3.2 动画停顿"></a>2.3.2 动画停顿</h4><p>上述图片轮播是持续不断的，即没有停顿。假设我们希望图片每次轮播之后停顿一段时间再轮播到下张图片，该如何实现呢？</p>
<center><video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614852362/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-8_sq6et6.mp4" autoplay style="height: 150px;"></center>

<center><video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614852362/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-7_azucdr.mp4" autoplay ></center>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> banner-swipe &#123;</span><br><span class="line">  0%, 10% &#123; <span class="attribute">left</span>: <span class="number">0</span>; &#125;</span><br><span class="line">  20%, 30% &#123; <span class="attribute">left</span>: -<span class="number">300px</span>; &#125;</span><br><span class="line">  40%, 50% &#123; <span class="attribute">left</span>: -<span class="number">600px</span>; &#125;</span><br><span class="line">  60%, 70% &#123; <span class="attribute">left</span>: -<span class="number">900px</span>; &#125;</span><br><span class="line">  80%, 100% &#123; <span class="attribute">left</span>: -<span class="number">1200px</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以按照上面的代码修改帧动画即可。下面解读一下帧动画代码的内容：</p>
<ul>
<li><p>0% ～ 10%：停留在第一张图片；</p>
</li>
<li><p>20% ～ 30%：停留在第二张图片；      </p>
</li>
<li><p>40% ～ 50%：停留在第三张图片；      </p>
</li>
<li><p>60% ～ 70%：停留在第四张图片；      </p>
</li>
<li><p>80% ～ 100%: 停留在第一张图片；</p>
</li>
<li><p>10% ～ 20%：从第一张图片到第二张图片过渡；</p>
</li>
<li><p>30% ～ 40%：从第二张图片到第三张图片过渡；</p>
</li>
<li><p>50% ～ 60%：从第三张图片到第四张图片过渡；</p>
</li>
<li><p>70% ～ 80%：从第四章图片到第一张图片过渡；</p>
</li>
</ul>
<p>注：上述keyframes动画在每张图片上停留的时间并不一致，这里我只是大概写一个demo，可以通过计算让每张图片停留时间以及过渡时间保持一致。</p>
<h2 id="3-列表轮播"><a href="#3-列表轮播" class="headerlink" title="3. 列表轮播"></a>3. 列表轮播</h2><h3 id="3-1-实现"><a href="#3-1-实现" class="headerlink" title="3.1 实现"></a>3.1 实现</h3><p>原理和图片轮播是一致的，在这里就当作是个练习写一下。</p>
<div style="display: flex; flex-direction: row; justify-content: center; align-items: center;">
<div>
<video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614856038/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-9_rxqowl.mp4" autoplay>
</div>
<div>
<video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614856039/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-10_pb1bsn.mp4" autoplay>
</div>
</div>


<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner-wrapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner-list"</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> banner-swipe &#123;</span><br><span class="line">  0% &#123; <span class="attribute">top</span>: <span class="number">0</span>; &#125;</span><br><span class="line">  33<span class="selector-class">.33</span>% &#123; <span class="attribute">top</span>: -<span class="number">50px</span>; &#125;</span><br><span class="line">  66<span class="selector-class">.66</span>% &#123; <span class="attribute">top</span>: -<span class="number">100px</span>; &#125;</span><br><span class="line">  100% &#123; <span class="attribute">top</span>: -<span class="number">150px</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-wrapper</span> &#123;</span><br><span class="line">	<span class="attribute">position</span>: relative;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">	<span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">	<span class="attribute">position</span>: absolute;</span><br><span class="line">	<span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">list-style</span>: none;</span><br><span class="line">	<span class="attribute">animation</span>: banner-swipe <span class="number">10s</span> ease-in infinite;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">	<span class="attribute">font-weight</span>: bold;</span><br><span class="line">	<span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child(1)</span>&#123;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#9370DB</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child(2)</span> &#123;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#7B68EE</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child(3)</span> &#123;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#6A5ACD</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.banner-list</span> <span class="selector-tag">div</span><span class="selector-pseudo">:nth-child(4)</span> &#123;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#483D8B</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-解决突现问题"><a href="#3-2-解决突现问题" class="headerlink" title="3.2 解决突现问题"></a>3.2 解决突现问题</h3><center><video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614856621/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-11_jz6lmd.mp4" autoplay></center>

<p>原理同上：在4后面增加一个1，同时帧动画多增加一帧。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner-wrapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner-list"</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> banner-swipe &#123;</span><br><span class="line">  0% &#123; <span class="attribute">top</span>: <span class="number">0</span>; &#125;</span><br><span class="line">  25% &#123; <span class="attribute">top</span>: -<span class="number">50px</span>; &#125;</span><br><span class="line">  50% &#123; <span class="attribute">top</span>: -<span class="number">100px</span>; &#125;</span><br><span class="line">  75% &#123; <span class="attribute">top</span>: -<span class="number">150px</span>; &#125;</span><br><span class="line">  100% &#123; <span class="attribute">top</span>: -<span class="number">200px</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-可视范围更改"><a href="#3-3-可视范围更改" class="headerlink" title="3.3 可视范围更改"></a>3.3 可视范围更改</h3><center><video src="https://res.cloudinary.com/dg7gqrbda/video/upload/v1614856993/blog/css%E8%BD%AE%E6%92%AD/css%E8%BD%AE%E6%92%AD-12_gmykfa.mp4" autoplay></center>

<p>假设我们现在向调整可视窗口，让一个窗口一次性展示两条数据，应该修改哪些内容呢？</p>
<ul>
<li>首先调整可视窗口大小，以两个为例，则高度放大为原来的两倍；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.banner-wrapper &#123;</span><br><span class="line">	position: relative;</span><br><span class="line">	width: <span class="number">300</span>px;</span><br><span class="line">	<span class="comment">// height: 50px;</span></span><br><span class="line">    height: <span class="number">100</span>px;</span><br><span class="line">	z-index: <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>html部分增加1、2两条数据。之前为了解决4到1的突然转变，在4后增加了1，现在是两条数据为一个整体，所以对应的要解决3、4到1、2的突变，所以要在4后边增加1、2.</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner-wrapper"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"banner-list"</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>调整banner-list的高度。每条数据高50px，之前是4条数据，现在是6条数据，所以要增高100px。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.banner-list &#123;</span><br><span class="line">	width: <span class="number">300</span>px;</span><br><span class="line">	<span class="comment">// height: 200px;</span></span><br><span class="line">    height: <span class="number">300</span>px;</span><br><span class="line">	position: absolute;</span><br><span class="line">	left: <span class="number">0</span>;</span><br><span class="line">	top: <span class="number">0</span>;</span><br><span class="line">	padding: <span class="number">0</span>;</span><br><span class="line">	margin: <span class="number">0</span>;</span><br><span class="line">	list-style: none;</span><br><span class="line">	animation: banner-swipe <span class="number">10</span>s ease-<span class="keyword">in</span> infinite;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>调整keyframes。之前每次展示一条，共四条数据，需要滚动三次完成，现在每次展示两条，滚动一次即可，每次滚动的偏移量也会发生改变。(原理详见<font style="color: orange">2.3 动画</font>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一条数据轮播</span></span><br><span class="line">@keyframes banner-swipe &#123;</span><br><span class="line">  <span class="number">0</span>% &#123; <span class="attr">top</span>: <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="number">33.33</span>% &#123; <span class="attr">top</span>: <span class="number">-50</span>px; &#125;</span><br><span class="line">  <span class="number">66.66</span>% &#123; <span class="attr">top</span>: <span class="number">-100</span>px; &#125;</span><br><span class="line">  <span class="number">100</span>% &#123; <span class="attr">top</span>: <span class="number">-150</span>px; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 两条数据轮播</span></span><br><span class="line">@keyframes banner-swipe &#123;</span><br><span class="line">  <span class="number">0</span>% &#123; <span class="attr">top</span>: <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="number">50</span>% &#123; <span class="attr">top</span>: <span class="number">-100</span>px; &#125;</span><br><span class="line">  <span class="number">100</span>% &#123; <span class="attr">top</span>: <span class="number">-200</span>px; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://xydida.com/2020/5/17/frontend/design-a-swiper-by-CSS/" target="_blank" rel="noopener">纯CSS实现轮播图</a></p>
 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
    <article
  id="post-depthWrite和depthTest属性"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/02/28/depthWrite%E5%92%8CdepthTest%E5%B1%9E%E6%80%A7/"
    >depthWrite和depthTest属性</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/02/28/depthWrite%E5%92%8CdepthTest%E5%B1%9E%E6%80%A7/" class="article-date">
  <time datetime="2021-02-28T10:33:44.000Z" itemprop="datePublished">2021-02-28</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/three/">three</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-写在前面"><a href="#1-写在前面" class="headerlink" title="1. 写在前面"></a>1. 写在前面</h2><p>在项目开发过程中，遇到如下情况：设计师提供的纹理背景是透明的，但是当多个纹理重叠的时候，还是会出现覆盖的情况，如下图所示。一开始使用depthTest属性没有解决，后来是通过将<font style="color: orange">depthWrite: false</font>实现的。具体原理在这里记录一下。   </p>
<div style="display: flex; flex-direction: row;justify-content:center;">
 <img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614654092/blog/depthWrite%E5%92%8CdepthTest/dd-1_qsqz1n.png"  style="width:260px; height:260px;" />
 <img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614654092/blog/depthWrite%E5%92%8CdepthTest/dd-2_ig9pbz.png" style="width:260px; height:260px;" />
</div>

<p>如左图所示，当三条线重叠的时候发生了覆盖，覆盖区域只有最上方线条的纹理展示，而其他线均被遮挡，但正常的情况应该如右图所示。</p>
<h2 id="2-原理"><a href="#2-原理" class="headerlink" title="2. 原理"></a>2. 原理</h2><p>在webgl中，深度会存储在depth buffer中，它和普通的颜色缓冲一样，只是存储的是深度值而已。深度值的精度一般有16位、24位和32位float，比较常用的深度精度为24位。</p>
<h3 id="2-1-depthTest"><a href="#2-1-depthTest" class="headerlink" title="2.1 depthTest"></a>2.1 depthTest</h3><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614671654/blog/depthWrite%E5%92%8CdepthTest/dd-5_ayuwif.png" />
<font style="color: orange">depthTest: 深度测试，默认值为true，可以设置为false来关闭深度测试。</font>在片元绘制过程中，会将像素的深度值与当前缓冲区中的值进行比较，如果大于等于深度缓冲区中值，则丢弃这部分不绘制，相当于在片元着色器中discard掉；否则利用这个像素对应的深度值和颜色值，分别更新深度缓冲区和颜色缓冲区。

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> geometry1 = <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>)</span><br><span class="line"><span class="keyword">const</span> geometry2 = <span class="keyword">new</span> THREE.BoxGeometry(<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>)</span><br><span class="line"><span class="keyword">const</span> material1 = <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</span><br><span class="line">  color: <span class="string">'blue'</span>,</span><br><span class="line">  depthTest: <span class="literal">true</span></span><br><span class="line">  <span class="comment">// depthTest: false</span></span><br><span class="line">  <span class="comment">// depthWrite默认值为true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> material2 = <span class="keyword">new</span> THREE.MeshBasicMaterial(&#123;</span><br><span class="line">  color: <span class="string">'yellow'</span>,</span><br><span class="line">  depthTest: <span class="literal">true</span></span><br><span class="line">  <span class="comment">// depthTest: false</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> mesh1 = <span class="keyword">new</span> THREE.Mesh(geometry1, material1)</span><br><span class="line"><span class="keyword">const</span> mesh2 = <span class="keyword">new</span> THREE.Mesh(geometry2, material2)</span><br><span class="line">mesh1.position.set(<span class="number">-100</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">mesh2.position.set(<span class="number">-90</span>, <span class="number">10</span>, <span class="number">-10</span>)</span><br><span class="line">scene.add(mesh1)</span><br><span class="line">scene.add(mesh2)</span><br></pre></td></tr></table></figure>

<p>以如上代码为例，在scene场景中添加了两个box物体，先添加的是蓝色的，后添加的是黄色的，可以看下当material的depthTest属性分别为true和false的时候对应的结果。</p>
<div style="display: flex; flex-direction: row;justify-content:center;">
 <img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614665197/blog/depthWrite%E5%92%8CdepthTest/dd-4_ugjicu.png"  style="width:280px; height:260px;" />
 <img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614665151/blog/depthWrite%E5%92%8CdepthTest/dd-3_wz11bx.png" style="width:260px; height:260px;" />
</div>
<div style="display: flex; flex-direction: row;justify-content:center;">
<div style="width: 400px;text-align: center;color: orange;">depthTest: true</div>
<div style="width: 400px;text-align: center;color: orange;">depthTest: false</div>
</div>

<p>以上面两张图片为例，默认开启深度写入<font style="color: orange;">depthWrite: true</font>.</p>
<ul>
<li><font style="color: orange;">depthTest: true</font>，开启深度检测。先绘制的是蓝色的box，此时depth buffer中没有值，所以蓝色box完整绘制，同时将蓝色box像素的深度值写入深度缓冲区(<font style="color: orange;">depthWrite控制是否写入深度缓冲区</font>)。因此在绘制黄色box时，会将像素点的深度值与深度缓冲区中已有的值进行比较，因为蓝色box的深度值已写入，所以黄色和蓝色重叠的部分就不会绘制，因此可以看出左图黄色box缺了一角。</li>
<li><font style="color: orange;">depthTest: false</font>，关闭深度检测。因为关闭了depthTest，黄色和蓝色box均正常绘制，但是位置上发生了重叠，后来居上，所以黄色遮盖了蓝色。因此此时的缺失是由于<font style="color:orange;">位置重叠</font>导致的，而不是深度检测。</li>
</ul>
<h3 id="2-2-depthWrite"><a href="#2-2-depthWrite" class="headerlink" title="2.2 depthWrite"></a>2.2 depthWrite</h3><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614671655/blog/depthWrite%E5%92%8CdepthTest/dd-6_uqjped.png" />
渲染材质时是否对深度缓冲区有任何影响，默认值为true。    
在绘制2D叠加时，为了将多个在一起的事物分层而不创建z-index伪像，禁用深度写入会很有用。

<div style="display: flex; flex-direction: row;justify-content:center;">
 <img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614654092/blog/depthWrite%E5%92%8CdepthTest/dd-1_qsqz1n.png"  style="width:260px; height:260px;" />
 <img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614654092/blog/depthWrite%E5%92%8CdepthTest/dd-2_ig9pbz.png" style="width:260px; height:260px;" />
</div>

<div style="display: flex; flex-direction: row;justify-content:center;">
<div style="width: 400px;text-align: center;color: orange;">depthWrite: true</div>
<div style="width: 400px;text-align: center;color: orange;">depthWrite: false</div>
</div> 

<p>以上面两张图片为例，默认开启深度检测<font style="color: orange;">depthTest: true</font>.</p>
<p>当绘制第一条线时，正常与深度缓冲区里当值做比较，正确绘制出前后关系：</p>
<ul>
<li><font style="color: orange;">depthWrite: true</font>，开启深度写入。绘制第一条线时，将满足条件的像素点绘制出来，同时利用这个像素对应的深度值和颜色值，分别更新深度缓冲区和颜色缓冲区。因此，在绘制第二条线时，深度缓冲区里已经包含里第一条线的深度值，所以深度检测时会与第一条线做比较，因此会出现第一条线遮挡第二条线的情况；</li>
<li><font style="color: orange;">depthWrite: false</font>，关闭深度写入。绘制第一条线时，将满足条件的像素点绘制出来，但<strong>不会</strong>利用这个像素对应但深度值和颜色值更新对应的缓冲区，即第一条线绘制结束后，深度缓冲区里并没有第一条线对应的深度值。因此，在绘制第二条线时，深度检测并不会检测与第一条线的深度关系，所以就不会出现第一条线遮盖第二条线的情况。</li>
</ul>
<h2 id="3-z-fighting的问题"><a href="#3-z-fighting的问题" class="headerlink" title="3. z-fighting的问题"></a>3. z-fighting的问题</h2><p>深度冲突又叫(z-fighting)是图形渲染中一个非常常见的现象。造成深度冲突的主要原因是两个三角面片十分靠近，在渲染的时候GPU很难分清到底哪个面在前，哪个面在后，从而形成闪烁的现象。</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614824299/blog/depthWrite%E5%92%8CdepthTest/dd-7_i12eku.png" style="width: 400px;height: 400px;"/></center>

<p>下面介绍一下这种情况出现时的解决方法。</p>
<ul>
<li><strong>简单直接的把两个靠近的面挪开一些</strong></li>
</ul>
<p>将两个面挪开一些距离，让他们不那么靠近，这样就不会争抢渲染，从而避免闪烁。<br>缺点：比较局限，不是所有模型都能手动修改，且工作量大。</p>
<ul>
<li><strong>调整camera的near、far参数</strong></li>
</ul>
<p>原理是当我们把裁剪空间转到ndc(归一化)空间的时候，会归一化z值，z值的范围越大，就会导致归一化后的位置相对越靠近，就更加容易产生z-fighting的现象。</p>
<ul>
<li><strong>使用对数缓冲</strong></li>
</ul>
<p>在threejs的renderer中可以启用logarithmicDepthBuffer属性，开启对数深度缓冲。<br>缺点：会使early-z的测试失效，从而造成一定程度的性能浪费。</p>
<ul>
<li><strong>使用polygonoffset</strong></li>
</ul>
<p>在threejs中通过设置material的polygonoffset属性，原理是在渲染时，将模型的订单稍微向靠近或原理相机的方向做一定的偏移，从而使两个相互靠近的面错开。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://zhuanlan.zhihu.com/p/151649142" target="_blank" rel="noopener">threejs中深度与透明</a><br><a href="http://www.yanhuangxueyuan.com/doc/Three.js/MaterialDepthTest.html" target="_blank" rel="noopener">Three.js材质深度测试.depthTest</a><br><a href="https://www.coder.work/article/1040467" target="_blank" rel="noopener">javascript - Three.js-depthWrite与depthTest在3个点上获得透明的 Canvas 纹理贴图</a></p>
 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
    <article
  id="post-css盒模型"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/02/22/css%E7%9B%92%E6%A8%A1%E5%9E%8B/"
    >css盒模型</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/02/22/css%E7%9B%92%E6%A8%A1%E5%9E%8B/" class="article-date">
  <time datetime="2021-02-22T11:57:57.000Z" itemprop="datePublished">2021-02-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/css/">css</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h2><p>css盒模型本质上是一个盒子，封装周围的HTML元素，包括：外边距(margin)、边框(border)、那边距(padding)、实际内容(content)四个属性。<br>css盒模型：<font style="color: orange">标准模型+IE模型</font></p>
<h3 id="1-1-W3C盒子模型-标准盒模型"><a href="#1-1-W3C盒子模型-标准盒模型" class="headerlink" title="1.1 W3C盒子模型(标准盒模型)"></a>1.1 W3C盒子模型(标准盒模型)</h3><center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613996125/blog/css%E7%9B%92%E6%A8%A1%E5%9E%8B/css%E7%9B%92%E6%A8%A1%E5%9E%8B-1_ftua5i.png" /></center>
属性width、height只包含内容content，不包含border和padding。

<h3 id="1-2-IE盒子模型-怪异盒模型"><a href="#1-2-IE盒子模型-怪异盒模型" class="headerlink" title="1.2 IE盒子模型(怪异盒模型)"></a>1.2 IE盒子模型(怪异盒模型)</h3><center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613996125/blog/css%E7%9B%92%E6%A8%A1%E5%9E%8B/css%E7%9B%92%E6%A8%A1%E5%9E%8B-2_a3mujv.png" /></center>
属性width、height包含border和padding，指的是content+padding+border。

<h2 id="2-知识点"><a href="#2-知识点" class="headerlink" title="2. 知识点"></a>2. 知识点</h2><h3 id="2-1-标准模型和IE模型的区别"><a href="#2-1-标准模型和IE模型的区别" class="headerlink" title="2.1 标准模型和IE模型的区别"></a>2.1 标准模型和IE模型的区别</h3><p><strong>计算宽度和高度的不同。</strong><br>标准盒模型：盒子总宽度/高度 = width/height + padding + border + margin (即width/height只是内容高度，不包含padding和border值)；<br>IE盒子模型：盒子总宽度/高度 = width/height + margin = (内容区宽度/高度 + padding + border) + margin. (即width/height包含了padding和border值)</p>
<h3 id="2-2-css如何设置这两种模型"><a href="#2-2-css如何设置这两种模型" class="headerlink" title="2.2 css如何设置这两种模型"></a>2.2 css如何设置这两种模型</h3><p>标准盒模型: box-sizing: content-box; (浏览器默认设置)<br>IE: box-sizing: border-box;</p>
<h3 id="2-3-JS如何获取盒模型对应宽和高"><a href="#2-3-JS如何获取盒模型对应宽和高" class="headerlink" title="2.3 JS如何获取盒模型对应宽和高"></a>2.3 JS如何获取盒模型对应宽和高</h3><p>1）<font style="color: orange">dom.style.width/height</font>只能取到行内样式的宽和高，style标签和link外联样式取不到；<br>2）<font style="color: orange">dom.currentStyle.width/height</font>取到的是最终渲染后的宽和高(只有IE兼容)；<br>3）<font style="color: orange">window.getComputedStyle(dom).width/height</font>同(2)，但是多浏览器支持，IE9以上支持；<br>4）<font style="color: orange">dom.getBoundingClientRect().width/height</font>也是得到渲染后的宽和高，大多浏览器支持。IE9以上支持，除此外还可以取到相对于视窗的上下左右的距离；<br>5）<font style="color: orange">dom.offsetWidth/offsetHeight</font>包含高度(宽度)、内边距和边框，不包括外边距，最常用，兼容性最好。</p>
<h2 id="3-BFC"><a href="#3-BFC" class="headerlink" title="3. BFC"></a>3. BFC</h2><h3 id="3-1-概念"><a href="#3-1-概念" class="headerlink" title="3.1 概念"></a>3.1 概念</h3><p>BFC(Block Formatting Context)：块级格式化上下文，是一种<strong>边距重叠解决方案</strong>。</p>
<h3 id="3-2-原理"><a href="#3-2-原理" class="headerlink" title="3.2 原理"></a>3.2 原理</h3><p>1）在BFC元素的垂直方向的边距会发生重叠；<br>2）BFC的区域不会与浮动元素Box重叠；<br>3）BFC在页面上是一个独立的容器，外面的元素不会影响里面的元素，反之，里面的元素也不会影响外面的元素；<br>4）计算BFC高度的时候，浮动元素也会参与计算。</p>
<h3 id="3-3-如何创建"><a href="#3-3-如何创建" class="headerlink" title="3.3 如何创建"></a>3.3 如何创建</h3><p>1）&lt;html&gt;根元素；<br>2）<strong>float</strong>值不为none，即只要设置了float值就创建了一个BFC；<br>3）<strong>position</strong>值不是static或relative，就创建了一个BFC；<br>4）<strong>display</strong>值为inline-block或table-cell或tabel-caption等，就创建了一个BFC；<br>5）<strong>overflow</strong>值不为visible，即为auto或者hidden时，就创建了一个BFC。</p>
<h3 id="3-4-使用场景"><a href="#3-4-使用场景" class="headerlink" title="3.4 使用场景"></a>3.4 使用场景</h3><h4 id="3-4-1-BFC垂直方向边距重叠问题"><a href="#3-4-1-BFC垂直方向边距重叠问题" class="headerlink" title="3.4.1 BFC垂直方向边距重叠问题"></a>3.4.1 BFC垂直方向边距重叠问题</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.margin</span> &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">background</span>: <span class="selector-id">#1890FF</span>;</span></span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.margin</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line">  margin: 15px auto 25px;</span><br><span class="line">  background: pink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"margin"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>4<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614505581/blog/css%E7%9B%92%E6%A8%A1%E5%9E%8B/css%E7%9B%92%E6%A8%A1%E5%9E%8B-3_vkntzm.png" /></center>
按照css样式，1、2、3、4的上边距应该都是15px，下边距都是25px，但是从图片很明显看出1和2、2和3、3和4之间的边距发生了重叠，重叠的原则就是取较大值，即1和2之间的距离是25px。   
那么如何解决该子元素的边距重叠问题呢？可以给某个子元素添加一个父元素，然后给这个父元素添加一个BFC可以解决。例如，给子元素2添加一个父元素div，然后给定样式<font style="color:orange">overflow: hidden</font>(这样可以创建一个BFC，详见3.3)。
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.margin</span> &#123;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">background</span>: <span class="selector-id">#1890FF</span>;</span></span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.margin</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line">  margin: 15px auto 25px;</span><br><span class="line">  background: pink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"margin"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"overflow: hidden"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>4<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614506649/blog/css%E7%9B%92%E6%A8%A1%E5%9E%8B/css%E7%9B%92%E6%A8%A1%E5%9E%8B-4_mscosp.png" /></center>
如图所示，1和2、2和3之间没有边距重叠的现象了，边距都变成15+25=40px，而不是之前取较大值都25px。

<h4 id="3-4-2-BFC不与float重叠"><a href="#3-4-2-BFC不与float重叠" class="headerlink" title="3.4.2 BFC不与float重叠"></a>3.4.2 BFC不与float重叠</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.layout</span> &#123;</span></span><br><span class="line">  background: blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.left</span> &#123;</span></span><br><span class="line">  float: left;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100px;</span><br><span class="line">  background: pink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.right</span> &#123;</span></span><br><span class="line">  height: 150px;</span><br><span class="line">  background: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"layout"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614507251/blog/css%E7%9B%92%E6%A8%A1%E5%9E%8B/css%E7%9B%92%E6%A8%A1%E5%9E%8B-5_w4xhbo.png" /></center>
图中可以看到1与2因为高度不同，发生了部分重叠，蓝色背景被完全遮挡。     
可以给右侧div设定<font style="color:orange">overflow: hidden</font>来创建一个BFC元素，消除重叠。
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-class">.layout</span> &#123;</span></span><br><span class="line">  background: blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.left</span> &#123;</span></span><br><span class="line">  float: left;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100px;</span><br><span class="line">  background: pink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.right</span> &#123;</span></span><br><span class="line">  height: 150px;</span><br><span class="line">  background: lightblue;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"layout"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614507474/blog/css%E7%9B%92%E6%A8%A1%E5%9E%8B/css%E7%9B%92%E6%A8%A1%E5%9E%8B-6_l8ogra.png" /></center>
图中可见1和2的重叠消除了，背景色蓝色显示出来了。

<h4 id="3-4-3-BFC子元素会参与高度计算"><a href="#3-4-3-BFC子元素会参与高度计算" class="headerlink" title="3.4.3 BFC子元素会参与高度计算"></a>3.4.3 BFC子元素会参与高度计算</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-id">#float</span> &#123;</span></span><br><span class="line">  background: blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.float</span> &#123;</span></span><br><span class="line">  float: left;</span><br><span class="line">  color: blue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">"float"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"float"</span>&gt;</span>这是一个浮动元素。<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614508061/blog/css%E7%9B%92%E6%A8%A1%E5%9E%8B/css%E7%9B%92%E6%A8%A1%E5%9E%8B-7_xvvgeq.png" /></center>
当子元素为浮动元素时，父级元素颜色未显示，高度未0，子元素不参与父级元素高度的计算。

<p>如果把父级元素设为BFC时，子元素也会参与到父级元素的高的计算中。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-id">#float</span> &#123;</span></span><br><span class="line">  background: blue;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-class">.float</span> &#123;</span></span><br><span class="line">  float: left;</span><br><span class="line">  color: white;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">"float"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"float"</span>&gt;</span>这是一个浮动元素。<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1614508062/blog/css%E7%9B%92%E6%A8%A1%E5%9E%8B/css%E7%9B%92%E6%A8%A1%E5%9E%8B-8_m4a1uw.png" /></center>
当给父元素添加<font style="color: orange">overflow: hidden</font>或<font style="color: orange">float: left</font>创建一个BFC后，父元素背景颜色出现，且子元素的高度参与了父元素高度的计算。


<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://juejin.cn/post/6844903505983963143" target="_blank" rel="noopener">CSS盒模型详解</a><br><a href="https://www.jianshu.com/p/8b8198095487" target="_blank" rel="noopener">深入理解CSS盒模型</a></p>
 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
    <article
  id="post-css中的white-space"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/02/22/css%E4%B8%AD%E7%9A%84white-space/"
    >css中的white-space</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/02/22/css%E4%B8%AD%E7%9A%84white-space/" class="article-date">
  <time datetime="2021-02-22T07:47:56.000Z" itemprop="datePublished">2021-02-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/css/">css</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-写在前面"><a href="#1-写在前面" class="headerlink" title="1. 写在前面"></a>1. 写在前面</h2><p>在开发过程中遇到以下场景，div没有固定的宽，需要根据内容自适应，并且不换行，这种情况下，white-space就起了很大作用。</p>
<h2 id="2-值"><a href="#2-值" class="headerlink" title="2. 值"></a>2. 值</h2><p>HTML语言的空格处理，就是将多个空格或回车直接合并成单个空格，这样的处理过于粗糙，忽视了原始文本内部的空格可能是有意义的。css提供了white-space属性，可以提供更精确多元的空格处理方式，该属性一共有六个值，normal | nowrap | pre | pre-wrap | pre-line | inherit，下面依次介绍。inherit为继承父元素的属性，在这里就不介绍了。</p>
<h3 id="2-1-white-space-normal"><a href="#2-1-white-space-normal" class="headerlink" title="2.1 white-space: normal"></a>2.1 white-space: normal</h3><p>white-space属性的默认值是normal，表示浏览器以正常方式处理空格。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>^^hellohellohello^hello</span><br><span class="line">world</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>为了更明显的展示空格，在这里我们以<font style="color: orange"> ^ </font>代表空格，可以看到上述文本前面有两个空格，文本内部有一个长单词、一个空格和换行符。</p>
<p>给容器<font style="color: orange">&lt;p&gt;</font>指定一个较小的宽度，添加一个橘色的背景色，方便识别。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613985315/blog/css-white-space/whitespace-2_faj4km.png" style="height: 100px;"/></center>
可以看到文首的空格被忽略，由于容器太窄，第一个单词溢出，然后在后面一个空格处换行，文本内部的换行符转成了空格。

<h3 id="2-2-white-space-nowrap"><a href="#2-2-white-space-nowrap" class="headerlink" title="2.2 white-space: nowrap"></a>2.2 white-space: nowrap</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当属性值为nowrap时，不会因为超出容器宽度而换行。</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613985590/blog/css-white-space/whitespace-3_fyqyxg.png" style="height: 60px;"/></center>

<p><strong>拓展</strong>  </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: orange;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">&lt;font style="color: orange"&gt;white-space: nowrap;&lt;/font&gt;经常和&lt;font style="color: orange"&gt;overflow:hidden;&lt;/font&gt;、&lt;font style="color: orange"&gt;text-overflow: ellipsis;&lt;/font&gt;一起使用，来实现文本过长显示省略号的效果.</span><br><span class="line">&lt;center&gt;&lt;img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613987553/blog/css-white-space/whitespace-7_fbrfrr.png" style="height: 50px;"/&gt;&lt;/center&gt;</span><br><span class="line"></span><br><span class="line">### 2<span class="selector-class">.3</span> <span class="selector-tag">white-space</span>: <span class="selector-tag">pre</span></span><br><span class="line">```<span class="selector-tag">css</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当属性值为pre时，就按照&lt;pre&gt;标签的方式处理.</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613985802/blog/css-white-space/whitespace-4_nvzsxu.png" style="height: 80px;"/></center>
效果和原始文本保持一致，文首的空格、内部的空格和换行符都保留了。

<h3 id="2-4-white-space-pre-wrap"><a href="#2-4-white-space-pre-wrap" class="headerlink" title="2.4 white-space: pre-wrap"></a>2.4 white-space: pre-wrap</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">white-space</span>: pre-wrap;</span><br></pre></td></tr></table></figure>
<p>当属性值为pre-wrap时，基本还是按照&lt;pre&gt;标签的方式处理，不同的是超出容器宽度时会发生换行。</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613985990/blog/css-white-space/whitespace-5_lwfc7u.png" style="height: 150px;"/></center>
文首的空格、内部的空格和换行符都保留了，超出容器的地方发生了换行。（注：可以发现多了一行空白行，这是因为文首是两个空格，接着展示<font style="color: orange">hellohellohello</font>这个长字符的时候，剩余的宽度展示不下，所以产生了换行；<font style="color: orange">hello</font>与<font style="color: orange">world</font>之前的换行时候代码中的换行符导致的。）

<h3 id="2-5-white-space-pre-line"><a href="#2-5-white-space-pre-line" class="headerlink" title="2.5 white-space: pre-line"></a>2.5 white-space: pre-line</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">white-space</span>: pre-line;</span><br></pre></td></tr></table></figure>
<p>当属性值为pre-line时，意为保留换行符，除了换行符会原样输出外，其他均与white-space: normal的规则保持一致。</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613986629/blog/css-white-space/whitespace-6_r8unlg.png" style="height: 120px;"/></center>
除了文本内部的换行符没有转成空格，其他都与normal的处理规则一致。这对于诗歌类型的文本很有用。

<h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3. 总结"></a>3. 总结</h2><table>
<thead>
<tr>
<th>whith-space属性</th>
<th>源码空格</th>
<th>源码换行</th>
<th>&lt;br&gt;换行</th>
<th>容器边界换行</th>
</tr>
</thead>
<tbody><tr>
<td>normal</td>
<td>合并</td>
<td>忽略</td>
<td>换行</td>
<td>换行</td>
</tr>
<tr>
<td>nowrap</td>
<td>合并</td>
<td>忽略</td>
<td>换行</td>
<td>不换行</td>
</tr>
<tr>
<td>pre</td>
<td>保留</td>
<td>换行</td>
<td>换行</td>
<td>不换行</td>
</tr>
<tr>
<td>pre-wrap</td>
<td>保留</td>
<td>换行</td>
<td>换行</td>
<td>换行</td>
</tr>
<tr>
<td>pre-line</td>
<td>合并</td>
<td>换行</td>
<td>换行</td>
<td>换行</td>
</tr>
</tbody></table>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.ruanyifeng.com/blog/2018/07/white-space.html" target="_blank" rel="noopener">CSS的空格处理</a><br><a href="https://blog.csdn.net/qq_33706382/article/details/78328188" target="_blank" rel="noopener">css white-space属性详解</a></p>
 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
    <article
  id="post-span间距"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/02/22/span%E9%97%B4%E8%B7%9D/"
    >span间距</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2021/02/22/span%E9%97%B4%E8%B7%9D/" class="article-date">
  <time datetime="2021-02-22T03:06:24.000Z" itemprop="datePublished">2021-02-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/css/">css</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-写在前面"><a href="#1-写在前面" class="headerlink" title="1. 写在前面"></a>1. 写在前面</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613964982/blog/span%E9%97%B4%E9%9A%94/span%E9%97%B4%E8%B7%9D-3_avkcga.png" style="height: 40px;" /></center>
在开发过程中，发现span标签存在间距，但是并没有对span标签设置任何样式，所以很困惑，在网上查询资料后解决，在这里记录一下。

<h2 id="2-原因"><a href="#2-原因" class="headerlink" title="2. 原因"></a>2. 原因</h2><p>为什么我们没有设置margin或者pandding会出现间隔呢？<br>浏览器会将多个连续空格或者回车都解析成单个空格，所以上面两个span标签之间都回车就被解析成了单个空格，图片中的间距就是就是空格。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello</span><br><span class="line">    world</span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613964650/blog/span%E9%97%B4%E9%9A%94/span%E9%97%B4%E9%9A%94-2_meaoxj.png" style="height: 100px" /></center>

<h2 id="3-解决方案"><a href="#3-解决方案" class="headerlink" title="3. 解决方案"></a>3. 解决方案</h2><h3 id="3-1-移除空格"><a href="#3-1-移除空格" class="headerlink" title="3.1 移除空格"></a>3.1 移除空格</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样写会让我们的代码看起来不整洁，可读性较低，有些人是接受不了的。 </p>
<p>或者</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>或者加注释</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  --&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613965028/blog/span%E9%97%B4%E9%9A%94/span%E9%97%B4%E8%B7%9D-4_ndvj1i.png" style="height: 40px" /></center>


<h3 id="3-2-通过css消除间距"><a href="#3-2-通过css消除间距" class="headerlink" title="3.2 通过css消除间距"></a>3.2 通过css消除间距</h3><p>使用margin/word-spacing/letter-spacing等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// margin</span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;span&gt;hello&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">  &lt;span style="margin-left: -5px;"&gt;world&lt;/</span>span&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">	</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ word-spacing</span></span><br><span class="line"><span class="regexp">&lt;div style="word-spacing: -40px;"&gt;</span></span><br><span class="line"><span class="regexp">  &lt;span&gt;hello&lt;/</span>span&gt;</span><br><span class="line">  &lt;span&gt;world&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// letter-spacing</span></span><br><span class="line">&lt;div style=<span class="string">"letter-spacing: -6px;"</span>&gt;</span><br><span class="line">  &lt;span style=<span class="string">"letter-spacing: 0px;"</span>&gt;hello&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">  &lt;span style="letter-spacing: 0px;"&gt;world&lt;/</span>span&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613965367/blog/span%E9%97%B4%E9%9A%94/span%E9%97%B4%E8%B7%9D-5_dkw1b6.png" style="height: 80px;" /></center>

<h3 id="3-3-使用font-size消除间距"><a href="#3-3-使用font-size消除间距" class="headerlink" title="3.3 使用font-size消除间距"></a>3.3 使用font-size消除间距</h3><p>将父元素的font-size设为0，这样空格就不会占位置，然后再对子元素单独设置font-size。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"font-size: 0;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"font-size: 20px;"</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"font-size: 20px;"</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1613965693/blog/span%E9%97%B4%E9%9A%94/span%E9%97%B4%E8%B7%9D-6_hbloxj.png" style="height: 40px;" /></center>

<h3 id="3-4-flex布局"><a href="#3-4-flex布局" class="headerlink" title="3.4 flex布局"></a>3.4 flex布局</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"display: flex;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-浮动"><a href="#3-5-浮动" class="headerlink" title="3.5 浮动"></a>3.5 浮动</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"float: left;"</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"float: left;"</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>查询了很多博客，发现大家都还要添加一句display: iniline-block，其实是不必要的，因为设置浮动之后，display会自动转block，为不是inline。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://juejin.cn/post/6844904083648675853" target="_blank" rel="noopener">两个span标签的间距问题</a></p>
<p><a href="https://www.zhangxinxu.com/wordpress/2012/04/inline-block-space-remove-%E5%8E%BB%E9%99%A4%E9%97%B4%E8%B7%9D/" target="_blank" rel="noopener">去除inline-block元素间间距的N种方法</a></p>
 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
    <article
  id="post-组件间的通信"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/11/15/%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/"
    >组件间的通信</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/11/15/%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/" class="article-date">
  <time datetime="2020-11-15T03:35:43.000Z" itemprop="datePublished">2020-11-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/vue/">vue</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>&emsp;&emsp;因为在项目中用到父子组件、兄弟组件、祖孙组件间的通信，加上之前有了解到vue provide inject也可以用来做通信，但是在网上找了很多博客将如何使用provide inject，运用到自己的代码中就是不生效，特此整理一篇各种组件关系间的各种通信方式，自己也新建了简单的项目来一一验证。</p>
<h3 id="1-各种组件关系及适用的通信方式"><a href="#1-各种组件关系及适用的通信方式" class="headerlink" title="1. 各种组件关系及适用的通信方式"></a>1. 各种组件关系及适用的通信方式</h3><p>&emsp;&emsp;如流程图所示，创建了四个子组件ABCD，AB和父组件是直接的父子关系，CD和父组件是隔代关系，A和B、C和D之间是兄弟关系，图上标注了各种通信之间适用的方法.   </p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1605597272/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E5%85%B3%E7%B3%BB%E6%B5%81%E7%A8%8B%E5%9B%BE_owmrsk.png"></img></center>

<p>选择标准：</p>
<ul>
<li>当项目比较大时，可以选择状态管理解决方案vuex；</li>
<li>要节制的使用$parent和$children，它们的主要目的是作为访问组件的应急方法，更推荐用props和events实现父子组件通信；</li>
<li>如果仅仅是传递数据，用$attrs/$listeners更好些，如果不仅传递数据，还做中间处理，就用vuex。</li>
</ul>
<p>下面来具体介绍一下这集中通信方式。</p>
<h3 id="2-props-emit"><a href="#2-props-emit" class="headerlink" title="2. props/$emit"></a>2. props/$emit</h3><ul>
<li>父组件向子组件传递数据 —&gt; props</li>
<li>子组件向父组件传递数据 —&gt; $emit<h4 id="2-1-父组件向子组件传递数据props"><a href="#2-1-父组件向子组件传递数据props" class="headerlink" title="2.1 父组件向子组件传递数据props"></a>2.1 父组件向子组件传递数据props</h4></li>
<li>父组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"father"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> <span class="attr">:msg</span>=<span class="string">"msg"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">'./child.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'Father'</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    Child</span><br><span class="line">  &#125;</span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      msg: <span class="string">'hello world'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>子组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>获取父组件的值：&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'Child'</span>,</span></span><br><span class="line"><span class="actionscript">  props: [<span class="string">'msg'</span>]</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      msg: <span class="string">'hello world'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606640917/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1-1_ufpc0z.png" /></center>


</li>
</ul>
<h4 id="2-2-子组件向父组件传递数据-emit"><a href="#2-2-子组件向父组件传递数据-emit" class="headerlink" title="2.2 子组件向父组件传递数据$emit"></a>2.2 子组件向父组件传递数据$emit</h4><ul>
<li>父组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"father"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> @<span class="attr">emitMsg</span>=<span class="string">"emitMsg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>msg from child: &#123;&#123;msgFromChild&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">'./child.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'Father'</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    Child</span><br><span class="line">  &#125;</span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      msgFromChild: <span class="string">''</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    emitMsg () &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.msgFromChild = <span class="string">'hello father'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>子组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>获取父组件的值：&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"emitMsg"</span>&gt;</span>点击向父组件传值<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'Child'</span>,</span></span><br><span class="line"><span class="actionscript">  props: [<span class="string">'msg'</span>]</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      msg: <span class="string">'hello world'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606642181/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1-2_ql63yw.gif" /></center>

</li>
</ul>
<p>注：$emit是可以传参的，this.$emit(函数名，参数)</p>
<h3 id="3-parent-children与ref"><a href="#3-parent-children与ref" class="headerlink" title="3. parent/children与ref"></a>3. parent/children与ref</h3><ul>
<li>子组件可以通过this.$parent访问父组件</li>
<li>父组件可以通过$children访问子组件</li>
<li>ref: 如果在普通的DOM元素上使用，引用指向的就是DOM元素；如果用在子组件上，引用就指向组件实例。</li>
</ul>
<p>注：要节制的使用$parent和$children，它们的主要目的是作为访问组件的应急方法，父子组件的通信更推荐使用props和events。</p>
<h4 id="3-1-parent-children"><a href="#3-1-parent-children" class="headerlink" title="3.1 parent/children"></a>3.1 parent/children</h4><ul>
<li>父组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"father"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"changeName"</span>&gt;</span>点击改变子组件的值<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">'./child.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'father'</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    Child</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      msg: <span class="string">'hello world'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    changeName () &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.$children[<span class="number">0</span>].message = <span class="string">"hello son"</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>子组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>获取父组件的值：&#123;&#123;parentValue&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data()&#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      message:<span class="string">'Good wether'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    parentValue () &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="keyword">this</span>.$parent.msg</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606643322/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1-3_xnycna.gif" /></center>

</li>
</ul>
<h4 id="3-2-ref"><a href="#3-2-ref" class="headerlink" title="3.2 ref"></a>3.2 ref</h4><ul>
<li>子组件<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      title: <span class="string">'son'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    sayHello () &#123;</span><br><span class="line">      <span class="built_in">window</span>.alert(<span class="string">'Hello'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>父组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child</span> <span class="attr">ref</span>=<span class="string">"child"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">'./child.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  mounted () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> component = <span class="keyword">this</span>.$refs.child</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(component.title)</span></span><br><span class="line">    component.sayHello()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606644165/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1-4_wxx5r2.png" /></center>

</li>
</ul>
<p>注：parent/children和ref这两种方法的弊端是无法在跨域兄弟间通信。</p>
<h3 id="4-emit-on"><a href="#4-emit-on" class="headerlink" title="4. emit/on"></a>4. emit/on</h3><p>用于父子、隔代、兄弟组件间通信。这种方式是通过类似一个中间.vue实例作为一个模块的事件中心，用它来触发和监听事件，从而实现任何组件间的通信。<br>首先，新建一个vue实例，然后在A组件中通过$emit方式去定义一个自定义事件方法，通过$on去接收A组件自定义事件传过来的值。   </p>
<ul>
<li>创建一个vue空白实例<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import Vue from 'vue'</span><br><span class="line">export default new Vue</span><br></pre></td></tr></table></figure></li>
<li>子组件A<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>A组件--&gt;&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"send"</span>&gt;</span>把a组件数据传给b<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Store <span class="keyword">from</span> <span class="string">'./store.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      msg: <span class="string">'Today is a wonderful day!'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    send () &#123;</span><br><span class="line"><span class="actionscript">      store.$emit(<span class="string">"emitMsg"</span>, <span class="keyword">this</span>.msg)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>子组件B<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>B组件--&gt;&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Store <span class="keyword">from</span> <span class="string">'./store.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      msg: <span class="string">''</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    send () &#123;</span><br><span class="line"><span class="actionscript">      store.$on(<span class="string">"emitMsg"</span>, (val) =&gt; &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.msg = val</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>父组件<br>将这两个子组件放在父组件中注册渲染<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child-a</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child-b</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> childA <span class="keyword">from</span> <span class="string">'./child-a.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> childB <span class="keyword">from</span> <span class="string">'./child-b.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    childA,</span><br><span class="line">    childB</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606646001/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1-5_qevd1l.gif" /></center>

</li>
</ul>
<h3 id="5-Vuex"><a href="#5-Vuex" class="headerlink" title="5. Vuex"></a>5. Vuex</h3><p>Vuex是一个专为Vue.js应用程序开发的状态管理模式，解决了组件之间同一状态的共享问题，它采用了集中式存储管理应用的所有组件的状态，所以组件就可以和store通讯，其实Vuex就是用来管理组件之间通信的一个组件。</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606650670/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1-6_bmmchw.png" /></center>

<h4 id="5-1-vuex模块介绍"><a href="#5-1-vuex模块介绍" class="headerlink" title="5.1 vuex模块介绍:"></a>5.1 vuex模块介绍:</h4><ul>
<li>state: 存放页面共享的状态字段；</li>
<li>getters: 相当于当前模块state的计算属性；</li>
<li>mutations: 如果想更新state中的字段，提交mutations中定义的事件是唯一的方式；</li>
<li>actions: 可以定义异步函数，并在回调中提交mutation，相当于异步更新了state中的字段；</li>
<li>modules: 类似与命名空间，用于项目中将各个模块的状态分开定义和操作，便于维护。</li>
</ul>
<h4 id="5-2-vuex实例应用"><a href="#5-2-vuex实例应用" class="headerlink" title="5.2 vuex实例应用"></a>5.2 vuex实例应用</h4><ul>
<li>父组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child-a</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child-b</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> ChildA <span class="keyword">from</span> <span class="string">'./child-a.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> ChildB <span class="keyword">from</span> <span class="string">'./child-b.vue'</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'App'</span>,</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    ChildA,</span><br><span class="line">    ChildB</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>子组件A<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是子组件A<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"transform"</span>&gt;</span>点我让B组件接收到数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;BMsg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      AMsg: <span class="string">'Hello, B组件, 我是A组件'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    BMsg () &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.state.BMsg</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    transform () &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.$store.commit(<span class="string">'receiveAMsg'</span>, AMsg: <span class="keyword">this</span>.AMsg)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>子组件B<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是B组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"transform"</span>&gt;</span>点我让A组件接收到数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;AMsg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      BMsg: <span class="string">'Hello, A组件, 我是B组件'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    AMsg () &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.state.AMsg</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  Methods: &#123;</span><br><span class="line">    transform () &#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">this</span>.$store.commit(<span class="string">'receiveBMsg'</span>, BMsg: <span class="keyword">this</span>.BMsg)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>vuex模块的store.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  AMsg: <span class="string">''</span>,</span><br><span class="line">  BMsg: <span class="string">''</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  receiveAMsg (state, payload) &#123;</span><br><span class="line">    state.AMsg = payload.AMsg</span><br><span class="line">  &#125;,</span><br><span class="line">  receiveBMsg (state, payload) &#123;</span><br><span class="line">    state.BMsg = payload.BMsg</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>根组件main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./app.vue'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store.js'</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  components: &#123; App &#125;,</span><br><span class="line">  template: <span class="string">'&lt;App/&gt;'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
将store实例从根组件注入到子组件中，在子组件中就可以通过this.$store调用。<br>如果编译的时候报如下错误：<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606654736/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1-7_zmr9me.png" /></center>
说明你目前运行的vue版本是run-time版本，而不是正式版本。run-time版本是没有编译器的，所以不能用template，此时需要利用 render 里的 h 函数来创建 HTML 节点，即：

</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  components: &#123; App &#125;,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606655450/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1-8_je97vp.gif" /></center>

<h3 id="6-attrs-listeners"><a href="#6-attrs-listeners" class="headerlink" title="6. attrs/listeners"></a>6. attrs/listeners</h3><p>用在父组件和子组件以及隔代组件之间传递数据，如果仅仅是传递数据，可以使用$attrs/listeners, 如果还需要对数据做处理，则用vuex好些。    </p>
<ul>
<li>$attrs     </li>
</ul>
<p>继承了父组件除了prop传递的属性、class和style之外的所有属性。当一个组件没有生命任何prop时，这里会包含所有父作用域的绑定（class和style除外），并且可以通过v-bind=”$attrs”传入内部组件。通常配合inheritAttrs选项一起使用。 </p>
<ul>
<li>$listeners</li>
</ul>
<p>它是一个对象，包含了父作用域中的v-on事件监听器，可以配合v-on=“$listeners”将所有的事件监听器指向这个组件的某个特定的子元素。</p>
<p>举例：假设三个组件ABC，A组件包含B组件，B组件包含C组件。</p>
<ul>
<li>A组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child1</span> <span class="attr">:p-child1</span>=<span class="string">"child1"</span> <span class="attr">:p-child2</span>=<span class="string">"child2"</span> <span class="attr">v-on:test1</span>=<span class="string">"onTest1"</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">v-on:test2</span>=<span class="string">"onTest2"</span></span></span><br><span class="line"><span class="tag">        //此处监听了两个事件，可以在<span class="attr">B</span>组件或者<span class="attr">C</span>组件中直接触发</span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">child1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Child1 <span class="keyword">from</span> <span class="string">'./Child1.vue'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">          child1: <span class="string">'child1'</span>,</span></span><br><span class="line"><span class="actionscript">          child2: <span class="string">'child2'</span></span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123; Child1 &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        onTest1() &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'test1 running...'</span>);</span></span><br><span class="line">        &#125;,</span><br><span class="line">        onTest2() &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'test2 running'</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>B组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child-1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>in child1:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>props: &#123;&#123;pChild1&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>$attrs: &#123;&#123;$attrs&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child2</span> <span class="attr">v-bind</span>=<span class="string">"$attrs"</span> <span class="attr">v-on</span>=<span class="string">"$listeners"</span>&gt;</span><span class="tag">&lt;/<span class="name">child2</span>&gt;</span></span><br><span class="line">            //v-on绑定了$listeners，所以C组件能直接触发test</span><br><span class="line">            //v-bind绑定了$attrs，所以C组件可以获取A组件传递下来的props的值</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Child2 <span class="keyword">from</span> <span class="string">'./Child2.vue'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    props: [<span class="string">'pChild1'</span>],</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;&#125;;</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">    inheritAttrs: <span class="literal">false</span>,</span></span><br><span class="line">    components: &#123; Child2 &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.$emit(<span class="string">'test1'</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>C组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child-2"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>in child2:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>props: &#123;&#123;pChild2&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>$attrs: &#123;&#123;$attrs&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    props: [<span class="string">'pChild2'</span>],</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;&#125;;</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">    inheritAttrs: <span class="literal">false</span>,</span></span><br><span class="line">    mounted() &#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.$emit(<span class="string">'test2'</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606706694/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1-9_p2hixc.png" /></center>
从上图可以看出，父组件中传递给子组件p-child1和p-child2,但是因为子组件的prop属性中含有p-child1,所以$attrs中只有p-child2。在组件B和C中都能通过$emit触发组件A中的方法，实现了父组件与子组件、隔代组件之间的通信。

</li>
</ul>
<h3 id="7-provide-inject"><a href="#7-provide-inject" class="headerlink" title="7. provide/inject"></a>7. provide/inject</h3><h4 id="7-1-基本使用"><a href="#7-1-基本使用" class="headerlink" title="7.1 基本使用"></a>7.1 基本使用</h4><p>provide/inject主要解决了跨域组件间的通讯问题。不过它的使用场景主要是子组件获取上级组件的状态，跨级组件间建立了一种主动提供与依赖注入的关系。   </p>
<ul>
<li>父组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child1</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Child1 <span class="keyword">from</span> <span class="string">'./child-a.vue'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  components: &#123;</span><br><span class="line">    Child1</span><br><span class="line">  &#125;,</span><br><span class="line">  provide () &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      name: <span class="string">'Tom'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>子组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child2</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Child2 <span class="keyword">from</span> <span class="string">'./child-b.vue'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    components: &#123;</span><br><span class="line">        Child2</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">    inject: [<span class="string">'name'</span>]</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>孙组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">    inject: [<span class="string">'name'</span>]</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1606708562/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1-10_nivvv4.png" /></center>

</li>
</ul>
<h4 id="7-2-用法解析"><a href="#7-2-用法解析" class="headerlink" title="7.2 用法解析"></a>7.2 用法解析</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件中provide有两种写法</span></span><br><span class="line"><span class="comment">// 第一种</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'father'</span>,</span><br><span class="line">  provide () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: <span class="string">'Tom'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第二种</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'father'</span>,</span><br><span class="line">  provide: &#123;</span><br><span class="line">    name: <span class="string">'Tom'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后代组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  inject: [<span class="string">'name'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两种用法的区别：   </p>
<ul>
<li>如果传递的是一个字符串，则上面两种用法是没有区别的；</li>
<li>如果传递的是一个对象，那么只能用第一种写法，根据兼容性，建议都按照第一种方法写。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当传递对象给后代时</span></span><br><span class="line">provide () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    msg: <span class="keyword">this</span>.msg</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>注意：后代组件中一旦注入了某个字段，如上面例子中的name字段，那么在这个组件中就不能再声明name这个字段了。</li>
</ul>
<h4 id="7-3-关于响应"><a href="#7-3-关于响应" class="headerlink" title="7.3 关于响应"></a>7.3 关于响应</h4><p>在vuex中，如果将<font color="orange">name: ‘Tom’</font>改为<font color="orange">name: ‘Cherry’</font>，子组件中的值会随之改变的，但是在provide/inject中并不会。</p>
<p>在vue官方文档中有这么一句话：<br>提示：provide和inject绑定并不是可响应的，这是刻意为之的。然而，如果你传入了一个可监听的对象，那么其对象的属性还是可响应的。</p>
<p>provide/inject不可响应式的机制保护了单向数据流，更深入的原因这里先不探究，展示一下什么情况下provide/inject可响应。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">provide () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    test: <span class="keyword">this</span>.msg</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    msg: <span class="string">'hello world'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">mounted () &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.msg = <span class="string">'have a nice day'</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>._provided.msg)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上所示，这样做是不行的，打印出来的provided中的数据并没有改变，子组件取得的值也没有变。我们甚至可以直接给this._provide.msg赋值，但是即使this._provide.msg发生改变，子组件的取值依然不变。</p>
<p><strong>如果改成以下写法，则可以响应</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">provide () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    test: <span class="keyword">this</span>.activeData</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    activeData: &#123; <span class="attr">name</span>: <span class="string">'Tom'</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">mounted () &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.activeData.name = <span class="string">'Cherry'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是vue中写到的<strong>对象的属性</strong>是可以响应的。如果你传入了一个可监听的对象，那么其对象的属性还是可响应的。</p>
<h4 id="7-4-实现全局变量"><a href="#7-4-实现全局变量" class="headerlink" title="7.4 实现全局变量"></a>7.4 实现全局变量</h4><p>provide/inject只能从祖先传递到后代，但是如果我们将其绑定到最顶层的组件，即app.vue，就可以将整个实例都传递给后代。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.vue</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'App'</span>,</span><br><span class="line">  provide () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      app: <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      text: <span class="string">'hello world'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    say () &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'have a nice day'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//其他所有子组件，需要全局变量的，只需要按需注入app即可</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  inject: [<span class="string">'app'</span>],</span><br><span class="line">  mounted () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'this.app.text'</span>) <span class="comment">// 获取app中的变量</span></span><br><span class="line">    <span class="keyword">this</span>.app.say() <span class="comment">// 可以执行app中的方法，变身为全局方法</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个是可以响应的。</p>
<h4 id="7-5-优缺点"><a href="#7-5-优缺点" class="headerlink" title="7.5 优缺点"></a>7.5 优缺点</h4><ul>
<li><p>优点：</p>
<p>可以非常方便快捷的进行父子组件及隔代组件间的通信。</p>
</li>
<li><p>缺点：</p>
<p>1）当多个后代组件同时依赖同一个父组件提供数据时，只要任一组件对数据进行了修改，所有依赖的组件都会受到影响，实际上是增加了耦合度。</p>
<p>2）任意层级访问使数据的追踪变的比较困难，不能准确定位到是哪一个层级对数据进行了改变。当数据出现问题时，尤其是多人协作时，会大大增加问题定位的损耗。</p>
</li>
</ul>
<h3 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. 总结</h3><center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1605597272/blog/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/%E7%BB%84%E4%BB%B6%E5%85%B3%E7%B3%BB%E6%B5%81%E7%A8%8B%E5%9B%BE_owmrsk.png"></img></center>

<ul>
<li><p>父子通信<br>props/emit、 parent/children、attrs/$listeners、provide/inject、ref  </p>
<ul>
<li>props: 父向子传递数据；</li>
<li>$emit/event: 子向父传递数据；</li>
<li>$parent: 子实例访问父实例；</li>
<li>$children: 父实例访问子实例；</li>
<li>$attrs: 父组件传递数据给子组件或孙组件（包含了父作用域中不作为prop被识别且获取的特性绑定，（class和style除外））；</li>
<li>$listeners: 父组件传递给子组件或孙组件，包含了父作用域中的（不含.native修饰器的）v-on事件监听器；</li>
<li>provide: 祖先组件提供变量给子孙组件；</li>
<li>inject: 子孙组件注入变量给祖先组件；</li>
<li>ref: 访问组件实例。</li>
</ul>
</li>
<li><p>兄弟通信</p>
<p>vuex</p>
</li>
<li><p>隔代通信</p>
<p>vuex、attrs/listeners、provide/inject</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://segmentfault.com/a/1190000022083517" target="_blank" rel="noopener">Vue组件间通信的6种方式</a></p>
<p><a href="https://segmentfault.com/a/1190000020954324" target="_blank" rel="noopener">你可能不知道的provide/inject用法</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/128977250" target="_blank" rel="noopener">Vue组件通信的几种方式汇总</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/147798646" target="_blank" rel="noopener">Vue组件通信–provide/inject</a></p>
</li>
</ul>
 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
    <article
  id="blog-css中的line-height"
  class="article article-type-blog"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/10/24/css%E4%B8%AD%E7%9A%84line-height/"
    >css中的line-height</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/10/24/css%E4%B8%AD%E7%9A%84line-height/" class="article-date">
  <time datetime="2020-10-24T11:06:58.000Z" itemprop="datePublished">2020-10-24</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/css/">css</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="1-写在前面"><a href="#1-写在前面" class="headerlink" title="1. 写在前面"></a>1. 写在前面</h3><p>之前遇到了文字向下偏移的情况，明明也没有也margin和padding，但是一直和外层的div框的位置有偏移的情况，最后才查出来是line-height的原因，那一刻我找到了自己在前端最不喜欢的东西—css。所以，写篇博客记录一下css中的line-height  </p>
<h3 id="2-基本概念"><a href="#2-基本概念" class="headerlink" title="2. 基本概念"></a>2. 基本概念</h3><h3 id="2-1-定义与图解"><a href="#2-1-定义与图解" class="headerlink" title="2.1 定义与图解"></a>2.1 定义与图解</h3><p><font style="color:orange">行高：</font>两行文字的基线之间的距离。   </p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603247558/blog/css%20line-height/css-line-height-2_idypdl.png"></img></center> 
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603246719/blog/css%20line-height/line-height-1_awm66o.png"></img></center>

<p>如图所示，baseline代表基线，就是英语四线格的倒数第二根线。两条红线之间的距离是<strong>行高</strong>(line-height)，上一行的底线(bottom)和下一行的顶线(top)之间的距离就是<strong>行距</strong>，同一行顶线和底线之间的距离代表<strong>font-size</strong>的大小，<strong>半行距</strong>是行距的一半。</p>
<div style="height: 40px;background:grey;text-align:center;line-height: 40px;">半行距 = (line-height - font-size) / 2</div>   
由公式可以看出，当line-height < font-size的时候，半行距为负值，这个时候两行文字就会出现重叠，如下图所示：   
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603977019/blog/css%20line-height/css-line-height-3_gaq02k.png"></img></center>

<h3 id="2-2-定义line-height的5种方式"><a href="#2-2-定义line-height的5种方式" class="headerlink" title="2.2 定义line-height的5种方式"></a>2.2 定义line-height的5种方式</h3><table>
<thead>
<tr>
<th>定义</th>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>line-height: normal</td>
<td>normal</td>
<td>默认。设置合理的行间距</td>
</tr>
<tr>
<td>line-height: inherit</td>
<td>inherit</td>
<td>从父元素继承line-height属性的值</td>
</tr>
<tr>
<td>line-height: 120%</td>
<td>百分比</td>
<td>基于当前字体尺寸的百分比行间距</td>
</tr>
<tr>
<td>line-height: 25px</td>
<td>固定值</td>
<td>设置固定的行间距</td>
</tr>
<tr>
<td>line-height: 1.2</td>
<td>number</td>
<td>数字与当前字体尺寸的乘积就是行间距</td>
</tr>
</tbody></table>
<h3 id="2-3-有关line-height的继承"><a href="#2-3-有关line-height的继承" class="headerlink" title="2.3 有关line-height的继承"></a>2.3 有关line-height的继承</h3><p>有些css属性是可以继承的，对于line-height而言，继承有些复杂。   </p>
<h4 id="2-3-1-百分比"><a href="#2-3-1-百分比" class="headerlink" title="2.3.1. 百分比"></a>2.3.1. 百分比</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">  line-height: 120%;</span><br><span class="line">&#125;</span><br><span class="line">h1 &#123; font-size: 32px &#125;</span><br><span class="line">p &#123; font-size: 16px &#125;</span><br><span class="line">#footer &#123; font-size: 12px &#125;</span><br></pre></td></tr></table></figure>
<p>body中line-height的百分比(120%)和文字大小(16px)用来计算行高的具体值为16px * 120% = 19.2px，这个具体的值会被层叠元素继承下去，所有继承的元素会忽略本身的font-size，而使用相同的父元素计算出来的line-height的值。<br>element|font-size|line-height|计算后的line-height<br>–|–|–|–<br>body|16px|120|16px*120%=<font style="color:orange">19.2px</font><br>h1|32px|继承的计算后的值|<font style="color:orange">19.2px</font><br>p|16px|继承的计算后的值|<font style="color:orange">19.2px</font><br>#footer|12px|继承的计算后的值|<font style="color:orange">19.2px</font>    </p>
<p>因为百分比的继承，继承的是计算后的具体的值，所以不会随着相关的font-size的不同，做相应的比例缩放，不管font-size的大小是多少，line-height都是固定值。</p>
<h4 id="2-3-2-长度"><a href="#2-3-2-长度" class="headerlink" title="2.3.2. 长度"></a>2.3.2. 长度</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">  line-height: 20px;</span><br><span class="line">&#125;</span><br><span class="line">h1 &#123; font-size: 32px &#125;</span><br><span class="line">p &#123; font-size: 16px &#125;</span><br><span class="line">#footer &#123; font-size: 12px &#125;</span><br></pre></td></tr></table></figure>
<p>如果line-height设置的是具体的长度值，那么这个值就会被后代元素继承。所有继承的元素都会忽略本身的font-size，而使用相同的继承而来的line-height。<br>element|font-size|line-height|计算后的line-height<br>–|–|–|–<br>body|16px|20px|<font style="color:orange">20px</font><br>h1|32px|继承值|<font style="color:orange">20px</font><br>p|16px|继承值|<font style="color:orange">20px</font><br>#footer|12px|继承值|<font style="color:orange">20px</font> </p>
<p>同样，因为子元素继承的是固定的长度值，所以line-height还是不会随着子元素的font-size的大小做相应的比例缩放。</p>
<h4 id="2-3-3-normal"><a href="#2-3-3-normal" class="headerlink" title="2.3.3 normal"></a>2.3.3 normal</h4><p>若line-height设为normal，此时代表的约为line-height: 1.2</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">  line-height: normal;</span><br><span class="line">&#125;</span><br><span class="line">h1 &#123; font-size: 32px &#125;</span><br><span class="line">p &#123; font-size: 16px &#125;</span><br><span class="line">#footer &#123; font-size: 12px &#125;</span><br></pre></td></tr></table></figure>
<p>如果是normal的情况，所有子元素不会忽略本身的font-size，而是基于自己的font-size和normal代表的倍数(约为1.2左右)，计算得到自己对应的line-height。<br>element|font-size|line-height|计算后的line-height<br>–|–|–|–<br>body|16px|normal|16px * 约1.2<font style="color:orange">约19.2px</font><br>h1|32px|normal|32px * 约1.2<font style="color:orange">约38.4px</font><br>p|16px|normal|16px * 约1.2<font style="color:orange">约19.2px</font><br>#footer|12px|normal|12px * 约1.2<font style="color:orange">约14.4px</font>    </p>
<p>这种情况下，各子元素的line-height会随着相关的font-size做相应比例的缩放。</p>
<h4 id="2-3-4-纯数字"><a href="#2-3-4-纯数字" class="headerlink" title="2.3.4 纯数字"></a>2.3.4 纯数字</h4><p>如果我们既想要normal的灵活，又想设置成一个自定义的值，这个时候就要使用纯数字的形式。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">  line-height: normal;</span><br><span class="line">&#125;</span><br><span class="line">h1 &#123; font-size: 32px &#125;</span><br><span class="line">p &#123; font-size: 16px &#125;</span><br><span class="line">#footer &#123; font-size: 12px &#125;</span><br></pre></td></tr></table></figure>
<p>现在所有子元素继承的line-height都是基于自己本身的font-size计算出来的。<br>element|font-size|line-height|计算后的line-height<br>–|–|–|–<br>body|16px|1.5|16px * 1.5<font style="color:orange">24px</font><br>h1|32px|1.5|32px * 1.5<font style="color:orange">48px</font><br>p|16px|1.5|16px * 1.5<font style="color:orange">24px</font><br>#footer|12px|1.5|12px * 1.5<font style="color:orange">18px</font>   </p>
<p>同样，这种情况下，line-height会随着font-size做相应的比例缩放。</p>
<p>那么具体使用哪一种line-height的方式，要具体情况具体对待。</p>
<h3 id="2-4-四种类型的css-box"><a href="#2-4-四种类型的css-box" class="headerlink" title="2.4 四种类型的css box"></a>2.4 四种类型的css box</h3><p>这四种盒子分别是<font style="color: orange">inline box、line box、content area、containing box</font>   </p>
<ul>
<li>inline-box(行内框)：每个行内元素会生成一个行内框，行内框是一个浏览器渲染模型中的一个概念，无法显示出来，行内框的高度等于<font style="color: orange">font-size</font>，设定<font style="color: orange">line-height</font>时，<strong>行内框的高度不变，改变的是行距</strong>。   </li>
<li>inline box(行框)：行框是指本行的一个虚拟的矩形框，由该行中行内框组成。行框也是浏览器渲染模式中的一个概念，无法显示出来。<strong>行框高度等于本行中所有行内框高度的最大值</strong>。当由多行内容时，每一行都有自己的行框。   </li>
<li>content area(内容区)：内容区是围绕着文字的一种box，无法显示出来。其高度取决于<font style="color: orange">font-size</font>和<font style="color: orange">padding</font>。</li>
<li>containing box：是包裹这上述三种box的box。<br>四种box之间的关系，可以看下图：<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1604228880/blog/css%20line-height/css-line-height-4_ro4ib6.png"></img></center>  

</li>
</ul>
<h3 id="3-参考"><a href="#3-参考" class="headerlink" title="3. 参考"></a>3. 参考</h3><p><a href="https://segmentfault.com/a/1190000003038583" target="_blank" rel="noopener">[学习笔记] css中的line-height</a><br><a href="https://www.cnblogs.com/fengzheng126/archive/2012/05/18/2507632.html" target="_blank" rel="noopener">深入了解css的行高Line Height属性</a></p>
 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
    <article
  id="blog-css中的伪类和伪元素"
  class="article article-type-blog"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/10/18/css%E4%B8%AD%E7%9A%84%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0/"
    >css中的伪类和伪元素</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/10/18/css%E4%B8%AD%E7%9A%84%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0/" class="article-date">
  <time datetime="2020-10-18T08:14:11.000Z" itemprop="datePublished">2020-10-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/css/">css</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-伪类与伪元素的区别"><a href="#1-伪类与伪元素的区别" class="headerlink" title="1. 伪类与伪元素的区别"></a>1. 伪类与伪元素的区别</h2><p>1）表示方法不同<br>css2中伪类、伪元素都是用<font color="orange"> : </font>表示，css2.1后规定，伪类用<font color="orange"> : </font>表示，伪元素用<font color="orange"> :: </font>表示，浏览器同样接受css2时代已经存在的伪元素(<font color="orange">:before, :after, :first-line, :first-letter等</font>)的单冒号的写法。对于css2之后的所有新增的伪元素(如<font color="orange">::selection</font>), 应该采用双冒号的写法。但是因为兼容性问题，大部分还是用的单冒号。<br>2）定义不同<br><strong>伪类</strong>: 核心是选择那些不能够被普通选择器选择的文档之外的元素，比如<font color="orange"> :hover </font>。<br><strong>伪元素</strong>: 核心是需要创建通常不存在与文档中的元素，比如<font color="orange"> ::before </font>。<br>3）种类不同</p>
<ul>
<li><p>伪类种类    </p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603102850/blog/css%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0-7_jnoyze.png"></scr></center>
常用的伪类有下面两种：  
</li>
<li><p>UI伪类：会在html元素处于某种状态时（比如鼠标指针位于链接式上），为该元素应用css样式；</p>
</li>
<li><p>结构化伪类：会在标记中存在某种结构上的关系时（如某个元素的一组元素中的第一个或者最后一个），为响应元素应用css样式。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>UI伪类</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>:active</td>
<td>将样式添加到被激活的元素</td>
</tr>
<tr>
<td>:focus</td>
<td>将样式添加到被选中的元素</td>
</tr>
<tr>
<td>:hover</td>
<td>当鼠标悬浮在元素上方时，向元素添加样式</td>
</tr>
<tr>
<td>:link</td>
<td>将特殊的样式添加到未被访问过的链接</td>
</tr>
<tr>
<td>:visited</td>
<td>将特殊的样式添加到被访问过的链接</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>结构伪类</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>:first-child</td>
<td>将特殊的样式添加到元素的第一个子元素</td>
</tr>
<tr>
<td>:last-child</td>
<td>选择父元素的倒数第一个子元素，相当于nth-last-child(1)</td>
</tr>
<tr>
<td>:nth-child(n)</td>
<td>选择父元素的第n个子元素，n从1开始计算</td>
</tr>
<tr>
<td>:nth-last-child(n)</td>
<td>选择父元素的倒数第n个自元素，n从1开始计算</td>
</tr>
<tr>
<td>:first-of-type</td>
<td>选择父元素下同种标签的第一个元素，相当于nth-of-type(1)</td>
</tr>
<tr>
<td>:last-of-type</td>
<td>选择父元素下同种标签的倒数第一个元素，相当于nth-last-of-type(1)</td>
</tr>
<tr>
<td>:nth-of-type(n)</td>
<td>选择使用同种标签的第n个元素</td>
</tr>
<tr>
<td>:nth-last-of-type(n)</td>
<td>选择同种标签的倒数第一个元素</td>
</tr>
<tr>
<td>:only-child</td>
<td>选择父元素下仅有的一个子元素</td>
</tr>
<tr>
<td>:empty</td>
<td>选择空结点，即没有子元素的元素，而且该元素也不包含任何文本节点</td>
</tr>
<tr>
<td>:root</td>
<td>选择文档的根元素，对于html文档，根元素永远是html</td>
</tr>
</tbody></table>
<ul>
<li>伪元素种类 </li>
</ul>
<table>
<thead>
<tr>
<th>UI伪类</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>::first-letter</td>
<td>向文本的第一个字幕添加特殊样式</td>
</tr>
<tr>
<td>::first-line</td>
<td>向文本的首行添加特殊样式</td>
</tr>
<tr>
<td>::before</td>
<td>在元素之前添加内容</td>
</tr>
<tr>
<td>::after</td>
<td>在元素之后添加内容</td>
</tr>
<tr>
<td>::selection</td>
<td>匹配突出选中的文本（用鼠标选择文本时的文本），该伪元素只接受两个属性background/color</td>
</tr>
</tbody></table>
<h2 id="2-优缺点"><a href="#2-优缺点" class="headerlink" title="2. 优缺点"></a>2. 优缺点</h2><p>伪元素的优缺点</p>
<ul>
<li>优点  <ol>
<li>不占用DOM节点，减少DOM节点数；</li>
<li>让css帮助解决了一部分javascript问题，简化了开发；</li>
<li>不仅块级元素可以设置伪元素，大部分行级元素也可以避免增加毫无意义的页面元素。   </li>
</ol>
</li>
<li>缺点<ol>
<li>不利于调试；</li>
<li>伪元素不真正在文档内容中提现，只是在视觉效果上体现，所以不能给伪元素添加具有实际意义的内容，这部分内容不会被搜索引擎抓取。</li>
</ol>
</li>
</ul>
<h2 id="3-注意事项"><a href="#3-注意事项" class="headerlink" title="3. 注意事项"></a>3. 注意事项</h2><ul>
<li>伪元素如果没有设置content属性(可为空值)，那么伪元素是无用的(可以将伪元素的内容设置为空)，content插入的内容默认是inline元素，可以通过display:block改变；</li>
<li>插入的内容在页面的源码里是不可见的，只能在css里面可见；</li>
<li>插入的伪元素默认情况是内联元素，因此为了给插入元素赋予高度、外边距、填充等等，必须显示定义它是一个块级元素；</li>
<li>典型的css继承规则适用于插入的伪元素，比如插入的字体，伪元素会像其他元素一样继承这些字体，同样的，伪元素不会继承没有自然继承自父元素的样式(如padding和margin)。</li>
</ul>
<h2 id="4-实战场景"><a href="#4-实战场景" class="headerlink" title="4. 实战场景"></a>4. 实战场景</h2><h3 id="伪类的使用场景"><a href="#伪类的使用场景" class="headerlink" title="伪类的使用场景"></a>伪类的使用场景</h3><ol>
<li>表单校验<br>表单的校验中，常用到<font color="orange"> :required、:valid、:invalid </font>这三个伪类：</li>
</ol>
<ul>
<li>:required，指具有required属性的表单元素；</li>
<li>:valid，指匹配指定要求的表单元素；</li>
<li>:invalid，指不匹配指定要求的表单元素。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>input中类型为email的校验<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>符合email校验规则<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">required</span> <span class="attr">placeholder</span>=<span class="string">"请输入"</span> <span class="attr">value</span>=<span class="string">"24238477@qq.com"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>不符合email校验规则<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">required</span> <span class="attr">placeholder</span>=<span class="string">"请输入"</span> <span class="attr">value</span>=<span class="string">"lalala"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>有required标识，但未填写<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">required</span> <span class="attr">placeholder</span>=<span class="string">"请输入"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">// css</span><br><span class="line">input &#123;</span><br><span class="line">  &amp;:valid &#123;</span><br><span class="line">    border-color: green;</span><br><span class="line">    box-shadow: inset 5px 0 0 green;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;:invalid &#123;</span><br><span class="line">    border-color: red;</span><br><span class="line">    box-shadow: inset 5px 0 0 red;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;:required &#123;</span><br><span class="line">    border-color: red;</span><br><span class="line">    box-shadow: inset 5px 0 0 red;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：   </p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603092720/blog/css%E4%BC%AA%E7%B1%BB%E4%B8%8E%E4%BC%AA%E5%85%83%E7%B4%A0_yflmaj.png" width="50%" height="60%"></img></center>

<ol start="2">
<li><p>折叠面板<br>之前只能通过js来实现折叠面板的显示或隐藏，现在可以通过目标伪类<font color="orange"> :target </font>来实现。:target是文档的内部链接，即URL后面跟有锚名称 #，指向文档内某个具体的元素。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"t-collapse"</span>&gt;</span></span><br><span class="line">  // 在url最后添加 #modal1，使得target生效</span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"collapse-target"</span> <span class="attr">href</span>=<span class="string">"#modal1"</span>&gt;</span>target 1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"collapse-body"</span> <span class="attr">id</span>=<span class="string">"modal1"</span>&gt;</span></span><br><span class="line">  // 将url的#modal1 变为 #，使得target失效</span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"collapse-close"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>target 1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// css</span><br><span class="line">.t-collapse &#123;</span><br><span class="line">  &gt;.collapse-body &#123;</span><br><span class="line">    &amp;:target &#123;</span><br><span class="line">      display: block;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定位第n个元素<br>可以通过<font color="orange"> :nth-child(n) </font>与<font color="orange"> :nth-of-type(n) </font>来定位一系列标签中的某个元素。区别：  </p>
</li>
</ol>
<ul>
<li>n可以是&gt;0的数字，或者类似2n+1的表达式，再或者是even/odd；</li>
<li>:nth-of-type(n)除了关注n，还需要关注最前面的类型；</li>
<li>:nth-child(n)关注的是父元素下的第n个子元素，与类型无关。<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>第一个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>第二个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>第三个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>第四个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>第五个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603095137/blog/css%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0-1_zoxtzj.png"></img></center>

</li>
</ul>
<h3 id="伪元素的使用场景"><a href="#伪元素的使用场景" class="headerlink" title="伪元素的使用场景"></a>伪元素的使用场景</h3><ol>
<li><p>清除浮动<br>通常我们清除浮动的方式就是在浮动元素后面添加一个空的div标签，然后设置它的清除浮动样式。如果使用伪元素::after，就不需要添加无意义的div标签在html中。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ul::after &#123;</span><br><span class="line">  clear: both;</span><br><span class="line">  content: '';</span><br><span class="line">  display: block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>美化选中的文本<br>在网页中，默认的划词效果是原字色保持不变，划过时背景变为蓝底色。我们可以通过<font color="orange"> ::selection </font>来实现定制。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Custom text selection color<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// css</span><br><span class="line">::selection &#123;</span><br><span class="line">  color: red;</span><br><span class="line">  background-color: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：  </p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603096679/blog/css%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0-2_pdwc8z.png" width="50%"></img></center>
</li>
<li><p>::before和::after<br>::before和::after必须配合content属性来使用，content用来定义插入的内容，必须有值，至少是空。默认情况下，伪元素的display的默认值是inline，可以通过设置display:block来改变其显示。content可以取以下值：</p>
</li>
</ol>
<ul>
<li><p>string  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-tag">p</span><span class="selector-pseudo">::before</span>&#123;</span></span><br><span class="line">    content: "《";</span><br><span class="line">    color: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-tag">p</span><span class="selector-pseudo">::after</span>&#123;</span></span><br><span class="line">    content: "》";</span><br><span class="line">    color: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>平凡的世界<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果： 《平凡的世界》</p>
</li>
<li><p>attr()<br>通过attr()调用当前元素的属性，比如将图片alt提示文字或者链接的href地址显示出来。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">a</span><span class="selector-pseudo">::after</span>&#123;</span></span><br><span class="line">        content: "("attr(href)")";</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603102971/blog/css%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0-8_kv5zva.png" width="50%"></img></center>
</li>
<li><p>rl()/uri()<br>用于引用媒体文件。<br>举例：“百度”文字前面给出一张图片，后面给出herf属性。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">a</span><span class="selector-pseudo">::before</span>&#123;</span></span><br><span class="line">        content: url("https://www.baidu.com/img/baidu_jgylogo3.gif");</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">  <span class="selector-tag">a</span><span class="selector-pseudo">::after</span>&#123;</span></span><br><span class="line">      content: "("attr(href)")";</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">```   </span><br><span class="line">效果：  </span><br><span class="line"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://res.cloudinary.com/dg7gqrbda/image/upload/v1603098415/blog/css%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0-3_n7vtyw.png"</span> <span class="attr">width</span>=<span class="string">"50%"</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"></span><br><span class="line">+ counter()   </span><br><span class="line">调用计数器，可以不使用列表元素实现序号功能。配合counter-increment和counter-reset属性使用。</span><br><span class="line">```html</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line">      body&#123;</span><br><span class="line">          counter-reset: section;</span><br><span class="line">      &#125;</span><br><span class="line">      h1&#123;</span><br><span class="line">          counter-reset: subsection;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-tag">h1</span><span class="selector-pseudo">:before</span>&#123;</span></span><br><span class="line"><span class="css">          <span class="selector-tag">counter-increment</span><span class="selector-pseudo">:section</span>;</span></span><br><span class="line"><span class="css">          <span class="selector-tag">content</span><span class="selector-pseudo">:counter(section)</span> "、";</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-tag">h2</span><span class="selector-pseudo">:before</span>&#123;</span></span><br><span class="line"><span class="css">          <span class="selector-tag">counter-increment</span><span class="selector-pseudo">:subsection</span>;</span></span><br><span class="line">          content: counter(section) "." counter(subsection) "、";</span><br><span class="line">      &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>HTML tutorials<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>HTML Tutorial<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>XHTML Tutorial<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>CSS Tutorial<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Scripting tutorials<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>VBScript<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>XML tutorials<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>XML<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>XSL<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603098808/blog/css%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0-4_iyhcbv.png" width="50%"></img></center>
</li>
<li><p>给blockquote添加引号<br>有时会用到给blockquote引用段添加巨大的引号作为背景，可以用::before来代替background。好处是既可以给背景留下空间，还可以直接使用文字而非图片。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">blockquote</span><span class="selector-pseudo">::before</span> &#123;</span></span><br><span class="line">    content: open-quote;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#ddd</span>;</span></span><br><span class="line">    z-index: -1;</span><br><span class="line"><span class="css">    <span class="selector-tag">font-size</span><span class="selector-pseudo">:80px</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">blockquote</span>&gt;</span>引用一个段落,双引号用::before伪元素实现<span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603099099/blog/css%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0-5_ur2ypd.png" width="50%"></img></center>
</li>
<li><p>超链接特效<br>例：配合css定位实现鼠标hover时，超链接出现方括号的效果。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line">body&#123;</span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#425a6c</span>;</span></span><br><span class="line">&#125;</span><br><span class="line">    a &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    outline: none;</span><br><span class="line"><span class="css">    <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line">    text-decoration: none;</span><br><span class="line">    font-size: 32px;</span><br><span class="line">    padding: 5px 20px;</span><br><span class="line">&#125;</span><br><span class="line"><span class="css"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::before</span>, <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123; <span class="attribute">position</span>: absolute; &#125;</span></span><br><span class="line"><span class="css"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::before</span> &#123; <span class="attribute">content</span>: <span class="string">"\5B"</span>; <span class="attribute">left</span>: -<span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="css"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123; <span class="attribute">content</span>: <span class="string">"\5D"</span>; <span class="attribute">right</span>:  -<span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span>&gt;</span>鼠标移上去出现方括号<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：</p>
<center><img src="https://res.cloudinary.com/dg7gqrbda/image/upload/v1603099604/blog/css%E4%BC%AA%E7%B1%BB%E5%92%8C%E4%BC%AA%E5%85%83%E7%B4%A0-6_chckls.png" width="50%"></img></center>

</li>
</ul>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2><ul>
<li>伪类和伪元素都是用来表示文档树以外的“元素”；</li>
<li>伪类和伪元素分别用<font color="orange"> : </font>和<font color="orange"> :: </font>表示；</li>
<li>最关键的区别是，如果没有伪类(伪元素), 是否需要添加元素才能达到目的，如果是则是伪元素，反之则是伪类；</li>
<li>伪类只要不是互斥，可以叠加使用；伪元素在一个选择器中只能出现一次，并且只能出现在末尾；</li>
<li>伪类与伪元素的优先级分别与类、标签的优先级相同。</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://juejin.im/post/6844903810951806989" target="_blank" rel="noopener">伪类与伪元素的区别</a><br><a href="https://www.html.cn/qa/css3/17445.html" target="_blank" rel="noopener">css伪类的种类有哪些？</a><br><a href="https://juejin.im/post/6844903761891213320" target="_blank" rel="noopener">「前端面试题系列3」伪类与伪元素的区别及实战
</a><br><a href="https://www.cnblogs.com/guangzhou11/p/7360589.html" target="_blank" rel="noopener">CSS3 ::before和::after伪元素的实际应用</a><br><a href="https://juejin.im/post/6844903969752350727" target="_blank" rel="noopener">伪类与伪元素的区别</a></p>
 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
    <article
  id="blog-vue中iframe的应用"
  class="article article-type-blog"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/10/17/vue%E4%B8%ADiframe%E7%9A%84%E5%BA%94%E7%94%A8/"
    >vue中iframe的应用</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/10/17/vue%E4%B8%ADiframe%E7%9A%84%E5%BA%94%E7%94%A8/" class="article-date">
  <time datetime="2020-10-17T06:06:59.000Z" itemprop="datePublished">2020-10-17</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/vue/">vue</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>最近项目中有个需求，就是将keynote中的ppt转成html，然后用iframe嵌入vue中，并在外部可以出发html上展示的ppt的上一页和下一页功能，这就涉及到vue和iframe之间的通信。记录一下。</p>
<p>先写一个简单到htmlDemo</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">"mainIframe"</span> <span class="attr">ref</span>=<span class="string">"mainIframe"</span> <span class="attr">name</span>=<span class="string">"mainIframe"</span> <span class="attr">:src</span>=<span class="string">"./demo.html"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">scrolling</span>=<span class="string">"auto"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'...'</span>,</span></span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  mounted () &#123;&#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"less"</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="父传子（vue-–-gt-iframe）"><a href="#父传子（vue-–-gt-iframe）" class="headerlink" title="父传子（vue –&gt; iframe）"></a>父传子（vue –&gt; iframe）</h2><h3 id="1-postMessage"><a href="#1-postMessage" class="headerlink" title="1. postMessage"></a>1. postMessage</h3><p>首先在父组件mounted的时候，要先获取到iframe的内容窗口：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在mounted生命周期中获取iframe的内容窗口</span></span><br><span class="line"><span class="keyword">this</span>.iframeWin = <span class="keyword">this</span>.$refs.mainIframe.contentWindow</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在methods中定义方法，向iframe传值时调用</span></span><br><span class="line">public sendMessage (val) &#123;</span><br><span class="line">  <span class="comment">// 外部vue向iframe内部传数据</span></span><br><span class="line">  <span class="keyword">this</span>.iframeWin.postMessage(&#123;</span><br><span class="line">    cmd: <span class="string">'returnInfo'</span>,</span><br><span class="line">    params: &#123;&#125;</span><br><span class="line">  &#125;, <span class="string">'*'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>iframe包裹的html页面中需要创建一个listener来监听父组件传过来的信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mounted 生命周期中定义监听</span></span><br><span class="line">mounted() &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"message"</span>, <span class="keyword">this</span>.handleMessageFromParent)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在methods中定义方法</span></span><br><span class="line">handleMessageFromParent (event) &#123;</span><br><span class="line">    <span class="keyword">var</span> data = event.data;</span><br><span class="line">    <span class="keyword">switch</span> (data.cmd) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'returnInfo'</span>:</span><br><span class="line">        <span class="keyword">this</span>.info = data.params.info</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-直接操作iframe"><a href="#2-直接操作iframe" class="headerlink" title="2. 直接操作iframe"></a>2. 直接操作iframe</h3><p>父级页面直接更改iframe里面的值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setData(data) &#123;</span><br><span class="line">  <span class="comment">// 获得对应iframe的window对象</span></span><br><span class="line">  <span class="keyword">const</span> obj1 = <span class="built_in">window</span>.frames[<span class="string">'mainIframe'</span>]</span><br><span class="line">  obj1.wpsData = <span class="string">'设置的数据'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证 发现wpsData数据已经改变</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  alert(wpsData) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是如果要在父组件中模拟子组件的点击或者是按键操作，还是要通过postMessage。例如，我在父组件中添加按钮，点击就可以触发iframe里html页面的切换或者其他操作。</p>
<h2 id="子传父（iframe-–-gt-vue）"><a href="#子传父（iframe-–-gt-vue）" class="headerlink" title="子传父（iframe –&gt; vue）"></a>子传父（iframe –&gt; vue）</h2><p>子组件传值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// methods中定义方法</span></span><br><span class="line"><span class="built_in">window</span>.parent.postMessage(&#123;</span><br><span class="line">  cmd: <span class="string">'returnInfo'</span>,</span><br><span class="line">  params: &#123;</span><br><span class="line">    info: <span class="string">'0101听到请回答'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="string">'*'</span>)</span><br></pre></td></tr></table></figure>
<p>父组件接收</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mounted 生命周期中定义监听</span></span><br><span class="line">mounted() &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">"message"</span>, <span class="keyword">this</span>.handleMessage)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同样在methods中定义一个方法</span></span><br><span class="line">handleMessage (event) &#123;</span><br><span class="line">  <span class="keyword">var</span> data = event.data;</span><br><span class="line">  <span class="keyword">switch</span> (data.cmd) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'returnInfo'</span>:</span><br><span class="line">        <span class="keyword">this</span>.info = data.info</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考博客：<br><a href="https://www.cnblogs.com/clwydjgs/p/11898622.html" target="_blank" rel="noopener">vue项目iframe的传值问题</a><br><a href="https://juejin.im/post/6844904126879367176" target="_blank" rel="noopener">vue中iframe的传值</a><br><a href="https://blog.csdn.net/qq_34335450/article/details/99851356" target="_blank" rel="noopener">postMessage和addEventListener踩坑</a></p>
<h2 id="未完待续…补充完善postMessage的相关原理"><a href="#未完待续…补充完善postMessage的相关原理" class="headerlink" title="未完待续…补充完善postMessage的相关原理"></a>未完待续…补充完善postMessage的相关原理</h2> 
      <!-- reward -->
      <!--  -->
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/study/" rel="tag">study</a></li></ul>

    </footer>
  </div>

     
   
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2021
        <i class="ri-heart-fill heart_icon"></i> John Doe
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        Powered by <a href="https://hexo.io" target="_blank">Hexo</a>
        <span class="division">|</span>
        Theme - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Cherry Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="http://shenyu-vip.lofter.com" target="_blank" rel="noopener">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/introduction">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


    
  </div>
</body>

</html>